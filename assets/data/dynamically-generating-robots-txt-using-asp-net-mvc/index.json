{"hash":"1a13dbe51a9813c01cad8b468348a7407a0fddcc","data":{"post":{"title":"Dynamically Generating Robots.txt Using ASP.NET MVC","path":"/dynamically-generating-robots-txt-using-asp-net-mvc/","date":"2015-07-31T00:00:00+00:00","dateModified":null,"timeToRead":4,"author":"Muhammad Rehan Saeed","headings":[{"value":"Dynamically Generating a robots.txt File"},{"value":"Conclusion"}],"tags":[{"id":".NET","title":".NET","path":"/tag/net/"},{"id":"ASP.NET MVC","title":"ASP.NET MVC","path":"/tag/asp-net-mvc/"},{"id":"ASP.NET Core Boilerplate","title":"ASP.NET Core Boilerplate","path":"/tag/asp-net-core-boilerplate/"},{"id":"C#","title":"C#","path":"/tag/c/"},{"id":"Robots","title":"Robots","path":"/tag/robots/"},{"id":"Search Engine Optimization (SEO)","title":"Search Engine Optimization (SEO)","path":"/tag/search-engine-optimization-seo/"},{"id":"Search Engines","title":"Search Engines","path":"/tag/search-engines/"},{"id":"Web Crawlers","title":"Web Crawlers","path":"/tag/web-crawlers/"}],"description":"How to dynamically generate a robots.txt file using a simple ASP.NET MVC action method and only a few lines of code.","content":"<ul>\n<li><a href=\"/asp-net-mvc-boilerplate/\">ASP.NET Core Boilerplate</a></li>\n<li>\n<p>Security</p>\n<ul>\n<li><a href=\"/securing-the-aspnet-mvc-web-config/\">Securing the ASP.NET MVC Web.config (Updated)</a></li>\n<li><a href=\"/nwebsec-asp-net-mvc-security-through-http-headers/\">NWebSec ASP.NET MVC Security Through HTTP Headers</a></li>\n<li><a href=\"/content-security-policy-for-asp-net-mvc/\">Content Security Policy (CSP) for ASP.NET MVC</a></li>\n</ul>\n</li>\n<li>\n<p>Search Engine Optimization (SEO)</p>\n<ul>\n<li><a href=\"/canonical-urls-for-asp-net-mvc/\">Canonical URL's for ASP.NET MVC</a></li>\n<li><a href=\"/dynamically-generating-robots-txt-using-asp-net-mvc\">Dynamically Generating Robots.txt Using ASP.NET MVC</a></li>\n</ul>\n</li>\n<li><a href=\"/internet-favicon-madness/\">Internet Favicon Madness (Updated)</a></li>\n<li><a href=\"/building-rssatom-feeds-for-asp-net-mvc/\">Building RSS/Atom Feeds for ASP.NET MVC</a></li>\n</ul>\n<p>A <code class=\"language-text\">robots.txt</code> file is a simple text file you can place at the root of your site at <code class=\"language-text\">http://example.com/robots.txt</code> to tell search engine robots (also known as web crawlers) how to index your site. The robots know to look for this file at the root of every site before they start indexing the site. If you do not have this file in your site, you will be getting a lot of 404 Not Found errors in your logs.</p>\n<p>The <code class=\"language-text\">robots.txt</code> uses the <a href=\"http://en.wikipedia.org/wiki/Robots_exclusion_standard\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Robots Exclusion Standard</a> which is a very simple format that can give robots instructions on what to index and what to skip. A very basic <code class=\"language-text\">robots.txt</code> file looks like this:</p>\n<div class=\"line-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Allow all robots to index this site.\nuser-agent: *\n\n# Tell all robots not to index any of the pages under the /error path.\ndisallow: /error/\n\n# Tell all robots to index the under the error/foo path.\nallow: /error/foo/\n\n# Add a link to the site-map. Unfortunately this must be an absolute URL.\nsitemap: http://example.com/sitemap.xml</code></pre></div>\n<p>In the above code, all comments start with the hash character. It tells all robots that they can index everything on the site except pages under the <code class=\"language-text\">/error</code> path because we don't want our error pages showing up in peoples search results. The only exception to that rule is to allow the resources under the <code class=\"language-text\">/error/foo</code> path to be indexed.</p>\n<p>The last line is interesting and tells robots where to find an XML file called a site-map. A site-map contains a list of URL's to all the pages in the site and is used to give search engines a list of URL's they can go through to index the entire site. It's a great SEO (Search Engine Optimization) technique to give your site a boost in it's search rankings.</p>\n<p>I will discuss creating a dynamic <code class=\"language-text\">sitemap.xml</code> file for ASP.NET Core in a future post. For now, all you need to know is that the site-map URL has to be an absolute URL according to the specification. This is a pretty terrible decision by whoever created the robots exclusion standard. It's really annoying that when you're creating a site, you have to remember to manually update this URL. If the URL was relative we would not have this problem.</p>\n<h1 id=\"dynamically-generating-a-robotstxt-file\"><a href=\"#dynamically-generating-a-robotstxt-file\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"true\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dynamically Generating a robots.txt File</h1>\n<p>Fortunately, it's really easy to dynamically create a <code class=\"language-text\">robots.txt</code> file, which auto-generates the site-map URL using the MVC <code class=\"language-text\">UrlHelper</code>. Take a look at the code below:</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HomeController</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">Controller</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">Route</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"robots.txt\"</span><span class=\"token punctuation\">,</span> Name <span class=\"token operator\">=</span> <span class=\"token string\">\"GetRobotsText\"</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">OutputCache</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span>Duration <span class=\"token operator\">=</span> <span class=\"token number\">86400</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\">ContentResult</span> <span class=\"token function\">RobotsText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">StringBuilder</span> stringBuilder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        stringBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">AppendLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user-agent: *\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        stringBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">AppendLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"disallow: /error/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        stringBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">AppendLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"allow: /error/foo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        stringBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">Append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sitemap: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        stringBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">AppendLine</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>Url<span class=\"token punctuation\">.</span><span class=\"token function\">RouteUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"GetSitemapXml\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">.</span>Url<span class=\"token punctuation\">.</span>Scheme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">TrimEnd</span><span class=\"token punctuation\">(</span><span class=\"token string character\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">Content</span><span class=\"token punctuation\">(</span>stringBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"text/plain\"</span><span class=\"token punctuation\">,</span> Encoding<span class=\"token punctuation\">.</span>UTF8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">Route</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"sitemap.xml\"</span><span class=\"token punctuation\">,</span> Name <span class=\"token operator\">=</span> <span class=\"token string\">\"GetSitemapXml\"</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">OutputCache</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span>Duration <span class=\"token operator\">=</span> <span class=\"token number\">86400</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\">ContentResult</span> <span class=\"token function\">SitemapXml</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// I'll talk about this in a later blog post.</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I set up a route to the <code class=\"language-text\">robots.txt</code> path at the root of the site in my main <code class=\"language-text\">HomeController</code> and cached the response for a day for better performance (You can and should probably specify a much longer period of time if you know yours won't change).</p>\n<p>I then go on to append my commands to the StringBuilder. The great thing is that I can easily use the <code class=\"language-text\">UrlHelper</code> to generate a complete absolute URL to the <code class=\"language-text\">sitemap.xml</code> path which is also dynamically generated in much the same way. Finally, I just return the string as plain text using the UTF-8 encoding.</p>\n<p>Creating a route ending with a file extension is not allowed by default in ASP.NET Core. To get around this security restriction, you need to add the following to the <code class=\"language-text\">Web.config</code> file:</p>\n<div class=\"line-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">&lt;!-- ...Omitted --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>system.webServer</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- ...Omitted --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>handlers</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token comment\">&lt;!-- ...Omitted --></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>add</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>RobotsText<span class=\"token punctuation\">\"</span></span> \n           <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>robots.txt<span class=\"token punctuation\">\"</span></span> \n           <span class=\"token attr-name\">verb</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>GET<span class=\"token punctuation\">\"</span></span> \n           <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>System.Web.Handlers.TransferRequestHandler<span class=\"token punctuation\">\"</span></span> \n           <span class=\"token attr-name\">preCondition</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>integratedMode,runtimeVersionv4.0<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>handlers</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>system.webServer</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h1 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"true\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h1>\n<p>Dynamically generating your <code class=\"language-text\">robots.txt</code> file is pretty easy and only takes as many lines of code as you need to write your <code class=\"language-text\">robots.txt</code> file anyway. It also means that you don't need to pollute your project structure with yet another file at the root of it (This problem is fixed in MVC Core, where all static files must be added to the wwwroot folder). You can also dynamically generate your site-map URL so you don't need to remember to update it every time you change the domain.</p>\n<p>You could argue that performance is an issue when compared to a static <code class=\"language-text\">robots.txt</code> text file but its a matter of a few bytes and if you cache the response with a sufficient time limit then I think that even that problem goes away.</p>\n<p>Once again, you can find a working example of this and much more using the <a href=\"https://visualstudiogallery.msdn.microsoft.com/6cf50a48-fc1e-4eaf-9e82-0b2a6705ca7d\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ASP.NET Core Boilerplate</a> project template.</p>\n","heroImage":"/images/hero/Robots.txt-1366x768.jpg"}},"context":{}}