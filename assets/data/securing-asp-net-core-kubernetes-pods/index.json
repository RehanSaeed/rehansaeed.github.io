{"hash":"3be4e55baae7f77c4b03389750f2d988f88707dc","data":{"post":{"title":"Securing ASP.NET Core Kubernetes Pods","path":"/securing-asp-net-core-kubernetes-pods/","date":"2020-04-30T00:00:00+00:00","dateModified":null,"timeToRead":1,"author":"Muhammad Rehan Saeed","headings":[],"tags":[{"id":"Kubernetes","title":"Kubernetes","path":"/tag/kubernetes/"},{"id":"Pod","title":"Pod","path":"/tag/pod/"},{"id":"Docker","title":"Docker","path":"/tag/docker/"}],"description":"","content":"<p>If you are using Kubernetes, you have a myriad of settings you can tweak under the <a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/security-context/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">securityContext</a> of your <code class=\"language-text\">Pod</code> or <code class=\"language-text\">Deployment</code>. Here is a sample <code class=\"language-text\">Pod</code>:</p>\n<div class=\"line-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>asp<span class=\"token punctuation\">-</span>app\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">securityContext</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runAsUser</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span>\n    <span class=\"token key atrule\">fsGroup</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2000</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>asp<span class=\"token punctuation\">-</span>app\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>asp<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">:</span>1.0.0\n    <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> COMPlus_EnableDiagnostics\n        <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">securityContext</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">allowPrivilegeEscalation</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n      <span class=\"token key atrule\">readOnlyRootFilesystem</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token key atrule\">capabilities</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">add</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"NET_ADMIN\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"SYS_TIME\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>The <code class=\"language-text\">allowPrivilegeEscalation</code> setting stops users who manage to get into your container from escalating their privileges to become a super user. I'm not sure why any container should need this enabled. Setting this to false should be the default but it isn't, you make sure to set this yourself. This is another case of an insecure default.</p>\n<p>In my last post in the series, I already discussed how to enable a read-only file system in your Docker container. I've already set <code class=\"language-text\">COMPlus_EnableDiagnostics</code> to zero using an environment variable and the <code class=\"language-text\">readOnlyRootFilesystem</code> is set to true to enable this feature.</p>\n<p>The <code class=\"language-text\">runAsUser</code> and <code class=\"language-text\">fsGroup</code> settings ensure that the user and group of the user running the app is not the root user. Some Docker images I have seen do this for you and bake these settings into the Docker image while others require you to manually specify another user as above. I raised an <a href=\"https://github.com/dotnet/dotnet-docker/issues/940\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">issue</a>...</p>\n<p>capabilities...blah blah blah</p>\n","heroImage":"/images/hero/Kubernetes-1366x768.png"}},"context":{}}