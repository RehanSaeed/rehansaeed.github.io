{"hash":"add2cee7f964391633d667fd907fd929152e07c4","data":{"post":{"title":"Dynamically Generating Sitemap.xml for ASP.NET MVC","path":"/dynamically-generating-sitemap-xml-for-asp-net-mvc/","date":"2015-09-15T00:00:00+00:00","dateModified":null,"timeToRead":8,"author":"Muhammad Rehan Saeed","headings":[{"value":"What is a sitemap.xml File"},{"value":"Is it Worth the Effort?"},{"value":"Generating a Static sitemap.xml File"},{"value":"Dynamically Generating Sitemap.xml for ASP.NET MVC"},{"value":"Sitemap Index Files"},{"value":"Conclusions"}],"tags":[{"id":".NET","title":".NET","path":"/tag/net/"},{"id":"ASP.NET MVC","title":"ASP.NET MVC","path":"/tag/asp-net-mvc/"},{"id":"ASP.NET Core Boilerplate","title":"ASP.NET Core Boilerplate","path":"/tag/asp-net-core-boilerplate/"},{"id":"Search Engine Optimization (SEO)","title":"Search Engine Optimization (SEO)","path":"/tag/search-engine-optimization-seo/"},{"id":"Sitemap","title":"Sitemap","path":"/tag/sitemap/"}],"description":"How to dynamically generate a sitemap.xml file using ASP.NET MVC to improve the Search Engine Optimization (SEO) of your site and get better search rankings.","content":"<h1 id=\"what-is-a-sitemapxml-file\"><a href=\"#what-is-a-sitemapxml-file\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is a sitemap.xml File</h1>\n<p>What is a <code class=\"language-text\">sitemap.xml</code> file used for? The official <a href=\"http://www.sitemaps.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">sitemaps.org</a> site really does says it best:</p>\n<blockquote>\n<p>Sitemaps are an easy way for webmasters to inform search engines about pages on their sites that are available for crawling. In its simplest form, a Sitemap is an XML file that lists URL's for a site along with additional metadata about each URL (when it was last updated, how often it usually changes, and how important it is, relative to other URL's in the site) so that search engines can more intelligently crawl the site.</p>\n<p>Web crawlers usually discover pages from links within the site and from other sites. Sitemaps supplement this data to allow crawlers that support Sitemaps to pick up all URL's in the Sitemap and learn about those URL's using the associated metadata. Using the Sitemap protocol does not guarantee that web pages are included in search engines, but provides hints for web crawlers to do a better job of crawling your site.</p>\n</blockquote>\n<div class=\"line-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>urlset</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://www.sitemaps.org/schemas/sitemap/0.9<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>url</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>loc</span><span class=\"token punctuation\">></span></span>http://www.example.com/<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>loc</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>lastmod</span><span class=\"token punctuation\">></span></span>2005-01-01<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>lastmod</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>changefreq</span><span class=\"token punctuation\">></span></span>monthly<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>changefreq</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>priority</span><span class=\"token punctuation\">></span></span>0.8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>priority</span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>url</span><span class=\"token punctuation\">></span></span>\n   <span class=\"token comment\">&lt;!-- ... --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>urlset</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>As you can see each URL in a sitemap contains four pieces of metadata:</p>\n<ul>\n<li><code class=\"language-text\">url</code> - The URL itself.</li>\n<li><code class=\"language-text\">lastmod</code> (Optional) - A last modified timestamp. This tells search engines whether or not they should re-index the page to reflect any changes that have been made.</li>\n<li><code class=\"language-text\">changefreq</code> (Optional) - A change frequency indicator (This can take the values: always, hourly, daily, weekly, monthly, yearly, never). This gives search engines an indication of how often they should come back and re-index the page.</li>\n<li><code class=\"language-text\">priority</code> (Optional) - A number from zero to one indicating the importance of the page compared to other pages on the site.</li>\n</ul>\n<p>The latter three values only give search engines an indication of when they can or should index or even re-index a page. It is not a guarantee that it will happen, although it makes it more likely.</p>\n<h1 id=\"is-it-worth-the-effort\"><a href=\"#is-it-worth-the-effort\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Is it Worth the Effort?</h1>\n<p>Search engines are black boxes. We only know what goes into them (Our sitemap) and what comes out the other end (The search results). I can make no promises that adding a sitemap will increase your sites search rankings but <strong>Google</strong> says:</p>\n<blockquote>\n<p>Using a sitemap doesn't guarantee that all the items in your sitemap will be crawled and indexed, as Google processes rely on complex algorithms to schedule crawling. However, <strong>in most cases, your site will benefit from having a sitemap</strong>, and you'll never be penalized for having one.</p>\n<footer><cite>[Google](https://support.google.com/webmasters/answer/156184?hl=en)</cite></footer>\n</blockquote>\n<h1 id=\"generating-a-static-sitemapxml-file\"><a href=\"#generating-a-static-sitemapxml-file\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Generating a Static sitemap.xml File</h1>\n<p>There are tools online you can use to generate a static <code class=\"language-text\">sitemap.xml</code> file, which you can dump at the root of your site but you have to manually update these every time your site changes. This may be fine if your site does not change much but adding a dynamically generated <code class=\"language-text\">sitemap.xml</code> file is fairly simple process and worth the effort.</p>\n<h1 id=\"dynamically-generating-sitemapxml-for-aspnet-mvc\"><a href=\"#dynamically-generating-sitemapxml-for-aspnet-mvc\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dynamically Generating Sitemap.xml for ASP.NET MVC</h1>\n<p>Dynamically generating a simple <code class=\"language-text\">sitemap.xml</code> file for ASP.NET MVC is really simple but adding all the bells and whistles requires a bit more work. We start with a SitemapNode and frequency enumeration which represents a single URL in our sitemap:</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SitemapNode</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> SitemapFrequency<span class=\"token punctuation\">?</span> Frequency <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">public</span> DateTime<span class=\"token punctuation\">?</span> LastModified <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">double</span><span class=\"token punctuation\">?</span> Priority <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">string</span> Url <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">enum</span> SitemapFrequency\n<span class=\"token punctuation\">{</span>\n    Never<span class=\"token punctuation\">,</span>\n    Yearly<span class=\"token punctuation\">,</span>\n    Monthly<span class=\"token punctuation\">,</span>\n    Weekly<span class=\"token punctuation\">,</span>\n    Daily<span class=\"token punctuation\">,</span>\n    Hourly<span class=\"token punctuation\">,</span>\n    Always\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we need to create a collection of <code class=\"language-text\">SitemapNode</code>'s. In my example below, I add the three main pages of my site, Home, About and Contact. I then go on to add a collection of product pages. I am getting every product ID from my database and using that to generate a product URL. Note that I'm not using every property on the <code class=\"language-text\">SitemapNode</code> class since in my case I don't have an easy way to figure out a last changed date but I do specify a priority and frequency for my products.</p>\n<p>Please note that the URL's must be absolute and I am using an extension method I wrote called <code class=\"language-text\">AbsoluteRouteUrl</code> to generate absolute URL's instead of relative ones. I have included that below too.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> IReadOnlyCollection<span class=\"token operator\">&lt;</span>SitemapNode<span class=\"token operator\">></span> <span class=\"token function\">GetSitemapNodes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UrlHelper</span> urlHelper<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    List<span class=\"token operator\">&lt;</span>SitemapNode<span class=\"token operator\">></span> nodes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token generic-method\"><span class=\"token function\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SitemapNode</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    nodes<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">SitemapNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            Url <span class=\"token operator\">=</span> urlHelper<span class=\"token punctuation\">.</span><span class=\"token function\">AbsoluteRouteUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HomeGetIndex\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            Priority <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    nodes<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>\n       <span class=\"token keyword\">new</span> <span class=\"token class-name\">SitemapNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n       <span class=\"token punctuation\">{</span>\n           Url <span class=\"token operator\">=</span> urlHelper<span class=\"token punctuation\">.</span><span class=\"token function\">AbsoluteRouteUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HomeGetAbout\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n           Priority <span class=\"token operator\">=</span> <span class=\"token number\">0.9</span>\n       <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    nodes<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>\n       <span class=\"token keyword\">new</span> <span class=\"token class-name\">SitemapNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n       <span class=\"token punctuation\">{</span>\n           Url <span class=\"token operator\">=</span> urlHelper<span class=\"token punctuation\">.</span><span class=\"token function\">AbsoluteRouteUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HomeGetContact\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n           Priority <span class=\"token operator\">=</span> <span class=\"token number\">0.9</span>\n       <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> productId <span class=\"token keyword\">in</span> productRepository<span class=\"token punctuation\">.</span><span class=\"token function\">GetProductIds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        nodes<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>\n           <span class=\"token keyword\">new</span> <span class=\"token class-name\">SitemapNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n           <span class=\"token punctuation\">{</span>\n               Url <span class=\"token operator\">=</span> urlHelper<span class=\"token punctuation\">.</span><span class=\"token function\">AbsoluteRouteUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ProductGetProduct\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">{</span> id <span class=\"token operator\">=</span> productId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n               Frequency <span class=\"token operator\">=</span> SitemapFrequency<span class=\"token punctuation\">.</span>Weekly<span class=\"token punctuation\">,</span>\n               Priority <span class=\"token operator\">=</span> <span class=\"token number\">0.8</span>\n           <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> nodes<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UrlHelperExtensions</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">string</span> <span class=\"token function\">AbsoluteRouteUrl</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">this</span> <span class=\"token class-name\">UrlHelper</span> urlHelper<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">string</span> routeName<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">object</span> routeValues <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">string</span> scheme <span class=\"token operator\">=</span> urlHelper<span class=\"token punctuation\">.</span>RequestContext<span class=\"token punctuation\">.</span>HttpContext<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">.</span>Url<span class=\"token punctuation\">.</span>Scheme<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> urlHelper<span class=\"token punctuation\">.</span><span class=\"token function\">RouteUrl</span><span class=\"token punctuation\">(</span>routeName<span class=\"token punctuation\">,</span> routeValues<span class=\"token punctuation\">,</span> scheme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now all we have to do is turn our collection of <code class=\"language-text\">SitemapNode</code>'s into XML:</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">string</span> <span class=\"token function\">GetSitemapDocument</span><span class=\"token punctuation\">(</span>IEnumerable<span class=\"token operator\">&lt;</span>SitemapNode<span class=\"token operator\">></span> sitemapNodes<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">XNamespace</span> xmlns <span class=\"token operator\">=</span> <span class=\"token string\">\"http://www.sitemaps.org/schemas/sitemap/0.9\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">XElement</span> root <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XElement</span><span class=\"token punctuation\">(</span>xmlns <span class=\"token operator\">+</span> <span class=\"token string\">\"urlset\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SitemapNode</span> sitemapNode <span class=\"token keyword\">in</span> sitemapNodes<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">XElement</span> urlElement <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XElement</span><span class=\"token punctuation\">(</span>\n            xmlns <span class=\"token operator\">+</span> <span class=\"token string\">\"url\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">XElement</span><span class=\"token punctuation\">(</span>xmlns <span class=\"token operator\">+</span> <span class=\"token string\">\"loc\"</span><span class=\"token punctuation\">,</span> Uri<span class=\"token punctuation\">.</span><span class=\"token function\">EscapeUriString</span><span class=\"token punctuation\">(</span>sitemapNode<span class=\"token punctuation\">.</span>Url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            sitemapNode<span class=\"token punctuation\">.</span>LastModified <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">?</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XElement</span><span class=\"token punctuation\">(</span>\n                xmlns <span class=\"token operator\">+</span> <span class=\"token string\">\"lastmod\"</span><span class=\"token punctuation\">,</span> \n                sitemapNode<span class=\"token punctuation\">.</span>LastModified<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">.</span><span class=\"token function\">ToLocalTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yyyy-MM-ddTHH:mm:sszzz\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            sitemapNode<span class=\"token punctuation\">.</span>Frequency <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">?</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XElement</span><span class=\"token punctuation\">(</span>\n                xmlns <span class=\"token operator\">+</span> <span class=\"token string\">\"changefreq\"</span><span class=\"token punctuation\">,</span> \n                sitemapNode<span class=\"token punctuation\">.</span>Frequency<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ToLowerInvariant</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            sitemapNode<span class=\"token punctuation\">.</span>Priority <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">?</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XElement</span><span class=\"token punctuation\">(</span>\n                xmlns <span class=\"token operator\">+</span> <span class=\"token string\">\"priority\"</span><span class=\"token punctuation\">,</span> \n                sitemapNode<span class=\"token punctuation\">.</span>Priority<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"F1\"</span><span class=\"token punctuation\">,</span> CultureInfo<span class=\"token punctuation\">.</span>InvariantCulture<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        root<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>urlElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token class-name\">XDocument</span> document <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XDocument</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we add an action method to our <code class=\"language-text\">HomeController</code> to get to our sitemap. Note the route to get to the sitemap. It is <a href=\"http://www.sitemaps.org/faq.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">recommended</a> to place your sitemap at the root of your site at <code class=\"language-text\">sitemap.xml</code>. Also note that creating a route with a file extension at the end (<code class=\"language-text\">.xml</code>) is not allowed in MVC 5 and below (ASP.NET Core is fine), so you need to add the line below in your <code class=\"language-text\">Web.config</code> file.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token punctuation\">[</span><span class=\"token class-name\">RoutePrefix</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HomeController</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">Controller</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">[</span><span class=\"token class-name\">Route</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sitemap.xml\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ActionResult</span> <span class=\"token function\">SitemapXml</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> sitemapNodes <span class=\"token operator\">=</span> <span class=\"token function\">GetSitemapNodes</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>Url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">string</span> xml <span class=\"token operator\">=</span> <span class=\"token function\">GetSitemapDocument</span><span class=\"token punctuation\">(</span>sitemapNodes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">Content</span><span class=\"token punctuation\">(</span>xml<span class=\"token punctuation\">,</span> ContentType<span class=\"token punctuation\">.</span>Xml<span class=\"token punctuation\">,</span> Encoding<span class=\"token punctuation\">.</span>UTF8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"line-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>system.webServer</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>handlers</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>add</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>SitemapXml<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>sitemap.xml<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">verb</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>GET<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>System.Web.Handlers.TransferRequestHandler<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">preCondition</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>integratedMode,runtimeVersionv4.0<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>handlers</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>system.webServer</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h1 id=\"sitemap-index-files\"><a href=\"#sitemap-index-files\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sitemap Index Files</h1>\n<p>For most people the above code will be enough. You can only have a maximum of 50,000 URL's in your sitemap and it must not exceed 10MB in size. I did some testing and if your URL's are fairly long and you supply all of the metadata for each URL, you can easily hit the 10MB mark with 25,000 URL's.</p>\n<p>It's not clear what happens if search engines come across a file that breaches these limits. I would have thought that the likes of Google or Bing would have a margin of error but it's better to be well under the limits than over. Not many sites have that many pages but you'd be surprised at how easy it is to hit these limits.</p>\n<p>This is where sitemap index files come in. The idea is that you break up your sitemap into pages and list all of these in an index file. When a search engine visits your <code class=\"language-text\">sitemap.xml</code> file, they retrieve the index file and visit each page in turn. Here is an example of an index file:</p>\n<div class=\"line-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>sitemapindex</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://www.sitemaps.org/schemas/sitemap/0.9<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>sitemap</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>loc</span><span class=\"token punctuation\">></span></span>http://www.example.com/sitemap1.xml<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>loc</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>lastmod</span><span class=\"token punctuation\">></span></span>2004-10-01T18:23:17+00:00<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>lastmod</span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>sitemap</span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>sitemap</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>loc</span><span class=\"token punctuation\">></span></span>http://www.example.com/sitemap2.xml.gz<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>loc</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>lastmod</span><span class=\"token punctuation\">></span></span>2005-01-01<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>lastmod</span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>sitemap</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>sitemapindex</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>As you can see you can optionally add a last modified date to each sitemap URL to tell search engines when a sitemap file has changed. This last modified date can be calculated from it's contents, you just need to take the latest last modified date from that particular page.</p>\n<p>This blog post has started to get a little long and I haven't even covered sitemap pinging yet, so I will not go into too much detail but I will refer you to where you can get at the full source code and worked example. Luckily, all of the code above and the code to generate a sitemap index file is available here:</p>\n<ul>\n<li>ASP.NET Core Boilerplate Framework NuGet packages for <a href=\"https://www.nuget.org/packages/Boilerplate.Web.Mvc5/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">MVC 5</a> and <a href=\"https://www.nuget.org/packages/Boilerplate.Web.Mvc6/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ASP.NET Core</a>.</li>\n<li>You can also generate a project using the <a href=\"https://visualstudiogallery.msdn.microsoft.com/6cf50a48-fc1e-4eaf-9e82-0b2a6705ca7d\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ASP.NET Core Boilerplate</a> project template to see the full code in action.</li>\n</ul>\n<h1 id=\"conclusions\"><a href=\"#conclusions\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusions</h1>\n<p>Adding a sitemap is a great Search Engine Optimization (SEO) technique to improve your sites search rankings. With my NuGet package, it makes it a really simple feature to add to your site. In my next blog post, I'll talk about sitemap pinging which can be used to pro-actively notify search engines of a change in your sitemap.</p>\n","heroImage":"/images/hero/Sitemaps-1366x768.png"}},"context":{}}