{"hash":"595f6691525f05239ad28f55ee37ee806c47c313","data":{"post":{"title":"C# 6.0 - Saving Developers From Themselves","path":"/c-6-0-saving-developers-from-themselves/","displayDate":"10 May 2015","date":"2015-05-10T00:00:00+00:00","timeToRead":5,"author":"Muhammad Rehan Saeed","headings":[{"value":"What's New in C# 6.0"},{"value":"The nameof Operator"},{"value":"Argument Exceptions"},{"value":"INotifyPropertyChanged"},{"value":"ASP.NET MVC"},{"value":"String Interpolation"},{"value":"The Null-Conditional Operator"},{"value":"Conclusions"}],"tags":[{"id":".NET","title":".NET","path":"/tag/net/"},{"id":"C#","title":"C#","path":"/tag/c/"},{"id":"C# 6.0","title":"C# 6.0","path":"/tag/c-6-0/"},{"id":"INotifyPropertyChanged","title":"INotifyPropertyChanged","path":"/tag/i-notify-property-changed/"},{"id":"nameof","title":"nameof","path":"/tag/nameof/"}],"description":"C# 6.0 helps reduce human error and save developers from themselves using the nameof operator, string interpolation and the null-conditional operator.","content":"<h1 id=\"whats-new-in-c-60\"><a href=\"#whats-new-in-c-60\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>What's New in C# 6.0</h1>\n<p>If you haven't already taken a look at what's new in C# 6.0, you should certainly read <a href=\"https://msdn.microsoft.com/en-us/magazine/dn802602.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this</a> article. This blog post is going to cover how C# 6.0 can help reduce the number of bugs in your code by giving you the tools to avoid common developer mistakes.</p>\n<p>In my opinion, the changes introduced in C# 6.0 can be split into two separate groups. The first group of changes seems to be a declaration of war on curly braces (<code class=\"language-text\">{}</code>), you can now omit them in many cases. I personally am not too sure about this set of features, it reduces the lines of code you have to write a little and may save a few seconds but at the cost of having to learn a new set of syntax. If you cast your mind back to being a newbie developer (or if you are one), lots of syntax to remember can be difficult to deal with.</p>\n<p>This is a problem that C++ developers know well, C++ is a pretty old language now but is still undergoing rapid development with C++ 11, 14 and beyond. It's got to the stage where there are so many ways to skin a cat in C++, even experienced developers can be slowed down when looking at code using older patterns and paradigms. The C# caretakers need to be careful that each new feature is genuinely worth the effort and not just bloat.</p>\n<p>The second set of features is what I am really interested in. These are features which will genuinely save you from yourself. They will stop developers making many common mistakes.</p>\n<h1 id=\"the-nameof-operator\"><a href=\"#the-nameof-operator\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>The nameof Operator</h1>\n<p>The nameof operator simply gives you the name of any type you pass into it. You can take a look at the simple example below:</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">string</span> obiwan<span class=\"token punctuation\">;</span>  \nConsole<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token function\">nameof</span><span class=\"token punctuation\">(</span>obiwan<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Prints obiwan</span>\n  \n<span class=\"token keyword\">int</span> kenobi <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\nConsole<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token function\">nameof</span><span class=\"token punctuation\">(</span>kenobi<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Prints kenobi</span></code></pre></div>\n<h2 id=\"argument-exceptions\"><a href=\"#argument-exceptions\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Argument Exceptions</h2>\n<p>So where can this help us? Well, I can think of a few examples, the first being throwing argument exceptions. Argument exceptions all take a parameter, which represents the name of the invalid parameter. In the past, we had to pass this as a string. The problem was that the parameter might get renamed and you might forget to update the string to reflect that.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">FightCrime</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> hero<span class=\"token punctuation\">)</span>  \n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hero <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>  \n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArgumentNullException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hero\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Omitted crime fighting code...  </span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">FightCrime</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> hero<span class=\"token punctuation\">)</span>  \n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hero <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>  \n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArgumentNullException</span><span class=\"token punctuation\">(</span><span class=\"token function\">nameof</span><span class=\"token punctuation\">(</span>hero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Omitted crime fighting code...  </span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With the second example, if you used Visual Studio to rename the hero parameter, then the hero in the <code class=\"language-text\">nameof</code> operator will also be updated.</p>\n<h2 id=\"inotifypropertychanged\"><a href=\"#inotifypropertychanged\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>INotifyPropertyChanged</h2>\n<p>This interface is notorious if you are doing any WPF/Silverlight/WinRT/XAML development, for requiring strings to be passed to it. With the <code class=\"language-text\">nameof</code> operator, this becomes a thing of the past.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Ship</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">INotifyPropertyChanged</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">event</span> <span class=\"token class-name\">PropertyChangedEventHandler</span> PropertyChanged<span class=\"token punctuation\">;</span>\t\n    \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">string</span> name<span class=\"token punctuation\">;</span>\n\t\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">string</span> Name\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">get</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">set</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnPropertyChanged</span><span class=\"token punctuation\">(</span><span class=\"token function\">nameof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\t\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">OnPropertyChanged</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> propertyName<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">PropertyChangedEventHandler</span> eventHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>PropertyChanged<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>eventHandler <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">eventHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PropertyChangedEventArgs</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"aspnet-mvc\"><a href=\"#aspnet-mvc\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>ASP.NET MVC</h2>\n<p>ASP.NET MVC makes massive use of strings everywhere. This is a massive problem when you want to rename something. In fact, I've taken to using constants everywhere. It's more work to setup but in the long run its much easier to maintain. Here is an example of how we can use nameof to create a link and do away with strings and constants:</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">@Html<span class=\"token punctuation\">.</span><span class=\"token function\">ActionLink</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Home\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Index\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Home\"</span><span class=\"token punctuation\">)</span>\n\n@Html<span class=\"token punctuation\">.</span><span class=\"token function\">ActionLink2</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Home\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">nameof</span><span class=\"token punctuation\">(</span>HomeController<span class=\"token punctuation\">.</span>Index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">nameof</span><span class=\"token punctuation\">(</span>HomeController<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">MvcHtmlString</span> <span class=\"token function\">ActionLink2</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span> <span class=\"token class-name\">HtmlHelper</span> htmlHelper<span class=\"token punctuation\">,</span> <span class=\"token keyword\">string</span> linkText<span class=\"token punctuation\">,</span> <span class=\"token keyword\">string</span> actionName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">string</span> controllerName<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    htmlHelper<span class=\"token punctuation\">.</span><span class=\"token function\">ActionLink</span><span class=\"token punctuation\">(</span>linkText<span class=\"token punctuation\">,</span> actionName<span class=\"token punctuation\">,</span> controllerName<span class=\"token punctuation\">.</span><span class=\"token function\">Substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> controllerName<span class=\"token punctuation\">.</span>Length <span class=\"token operator\">-</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The above example is a little contrived. In the real world, I would never use <code class=\"language-text\">ActionLink</code> and use <code class=\"language-text\">RouteLink</code> instead. Naming your routes has better performance and is just easier to understand when you have multiple routes with the same name (for GET and POST requests).</p>\n<h1 id=\"string-interpolation\"><a href=\"#string-interpolation\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>String Interpolation</h1>\n<p>I think we've all used <code class=\"language-text\">string.Format</code> and got our arguments in the wrong positions or entered the index numbers incorrectly at some point in time. Well, that bug is now a thing of the past.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token comment\">// Before C# 6.0 String Interpolation</span>\n<span class=\"token keyword\">string</span> nameAndAge <span class=\"token operator\">=</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">Format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Name:{0}, Age:{1}\"</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// After C# 6.0 String Interpolation</span>\n<span class=\"token keyword\">string</span> nameAndAge <span class=\"token operator\">=</span> $<span class=\"token string\">\"Name:{name}, Age:{age}\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>As you can see, you can now use your parameters directly in the strings with full syntax highlighting and renaming support too. In fact the C# 6.0 code actually compiles down to doing a <code class=\"language-text\">string.Format</code> behind the scenes.</p>\n<h1 id=\"the-null-conditional-operator\"><a href=\"#the-null-conditional-operator\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>The Null-Conditional Operator</h1>\n<p>Every C# developer has at some point stared at the text from a <code class=\"language-text\">NullReferenceException</code> and thought in their head, this is a really rubbish message and leaves out vital information. In fact there is <a href=\"https://visualstudio.uservoice.com/forums/121579-visual-studio/suggestions/2371587-better-nullpointerexception-error-message\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this</a> post on UserVoice, asking Microsoft to improve their NullReferenceException messages. It turns out that Microsoft has thought of this, they haven't improved the message (They still should, please up-vote the UserVoice post) but they have introduced the Null-Conditional operator.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">string</span> <span class=\"token function\">Truncate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> length<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">string</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">value</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        result <span class=\"token operator\">=</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">.</span><span class=\"token function\">Substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">Min</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">value</span><span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">,</span> length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">string</span> <span class=\"token function\">Truncate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> length<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>          \n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">?.</span><span class=\"token function\">Substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">Min</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">value</span><span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">,</span> length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Wow, look at all this code I didn't have to write!</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1 id=\"conclusions\"><a href=\"#conclusions\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Conclusions</h1>\n<p>As you can see there is a common theme with two of the three C# 6.0 features I've picked above. They give us tools to better deal with strings which have terrible IDE and language support. Making a typo in a string gives us no compile time errors and Visual Studio doesn't help either. Each of these features has allowed us to deal with strongly typed objects instead, which have full language and IDE support.</p>\n<p>The Null-Conditional operator is another great tool to help mitigate really common but minor bugs that catch even the most experienced developers out. These are great features, and should help stop silly mistakes that all of us developers make. We are after all, human.</p>\n","cover_image":"/images/hero/NET-1366x768.png"}},"context":{}}