{"hash":"47065721ec8cf1ae2c40f8ee413cfcbaa7ea09b8","data":{"tag":{"title":"BCL","path":"/tag/bcl/","belongsTo":{"edges":[{"node":{"title":"Reactive Extensions (Rx) – Part 8 – Timeouts","path":"/reactive-extensions-rx-part-8-timeouts/","date":"2 January 2017","timeToRead":1,"description":"Should you use Reactive Extensions (Rx) to do timeouts in .NET? It turns out it's better to use CancellationTokenSource in the Task Parallel Library (TPL).","content":"<ul>\n<li><a href=\"/reactive-extensions-part1-replacing-events/\">Reactive Extensions (Rx) - Part 1 - Replacing C# Events</a></li>\n<li><a href=\"/reactive-extensions-part2-wrapping-events/\">Reactive Extensions (Rx) - Part 2 - Wrapping C# Events</a></li>\n<li><a href=\"/reactive-extensions-part3-naming-conventions/\">Reactive Extensions (Rx) - Part 3 - Naming Conventions</a></li>\n<li><a href=\"/reactive-extensions-part4-replacing-timers/\">Reactive Extensions (Rx) - Part 4 - Replacing Timers</a></li>\n<li><a href=\"/reactive-extensions-part4-awaiting-observables/\">Reactive Extensions (Rx) - Part 5 - Awaiting Observables</a></li>\n<li><a href=\"/reactive-extensions-part6-task-toobservable/\">Reactive Extensions (Rx) - Part 6 - Task ToObservable</a></li>\n<li><a href=\"/reactive-extensions-part7-sample-events/\">Reactive Extensions (Rx) - Part 7 - Sample Events</a></li>\n<li><a href=\"/reactive-extensions-rx-part-8-timeouts/\">Reactive Extensions (Rx) - Part 8 - Timeouts</a></li>\n</ul>\n<p>In <a href=\"/reactive-extensions-part6-task-toobservable/\">part six</a> of this series of blog posts I talked about using Reactive Extensions for adding timeout logic to asynchronous tasks. Something like this:</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> Task<span class=\"token operator\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token operator\">></span> <span class=\"token function\">WaitForFirstResultWithTimeOut</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    Task<span class=\"token operator\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token operator\">></span> task <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">DownloadTheInternet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> task\n        <span class=\"token punctuation\">.</span><span class=\"token function\">ToObservable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">Timeout</span><span class=\"token punctuation\">(</span>TimeSpan<span class=\"token punctuation\">.</span><span class=\"token function\">FromMilliseconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">FirstAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Last week I was working on a project and wanted to add a Timeout to my task but since it was an ASP.NET MVC project, I had no references to Reactive Extensions. After some thought I discovered another possible method of performing a timeout which may help in certain circumstances.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">using</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> cancellationTokenSource <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CancellationTokenSource</span><span class=\"token punctuation\">(</span>TimeSpan<span class=\"token punctuation\">.</span><span class=\"token function\">FromMilliseconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">DownloadTheInternet</span><span class=\"token punctuation\">(</span>cancellationTokenSource<span class=\"token punctuation\">.</span>Token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">OperationCanceledException</span> exception<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Timed Out\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I'm using an overload on CancellationTokenSource which takes a timeout value. Then passing the <code class=\"language-text\">CancellationToken</code> to <code class=\"language-text\">DownloadTheInternet</code>. This method should be periodically checking the <code class=\"language-text\">CancellationToken</code> to see if it has been cancelled and if so, throw an <code class=\"language-text\">OperationCanceledException</code>. In this example you'd probably use HttpClient which handles this for you if you give it the CancellationToken.</p>\n<p>The main reason why this method is better is that the task is actually being cancelled and stopped from doing any more work. In my above reactive extensions example, the task continues doing work but it's result is just ignored.</p>\n"}},{"node":{"title":"Logging with Serilog.Exceptions","path":"/logging-with-serilog-exceptions/","date":"31 January 2016","timeToRead":4,"description":"Log exception details and custom properties that are not output in Exception.ToString() using Serilog.Exceptions for .NET.","content":"<p>Picking a logging framework for your new .NET project? I've tried all the best known ones, including <a href=\"https://logging.apache.org/log4net/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">log4net</a>, <a href=\"http://nlog-project.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NLog</a> and Microsoft's <a href=\"https://msdn.microsoft.com/en-us/library/ff647183.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Logging Application Block</a>. All of these logging frameworks basically output plain text but recently I tried <a href=\"http://serilog.net/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Serilog</a> and was literally blown away by what you could do with it.</p>\n<h1 id=\"logging-in-json-format\"><a href=\"#logging-in-json-format\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Logging in JSON Format</h1>\n<p>Take a look at the code below which makes use of the Serilog logger to log a geo-coordinate and an integer:</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">var</span> position <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">{</span> Latitude <span class=\"token operator\">=</span> <span class=\"token number\">25</span><span class=\"token punctuation\">,</span> Longitude <span class=\"token operator\">=</span> <span class=\"token number\">134</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> elapsedMs <span class=\"token operator\">=</span> <span class=\"token number\">34</span><span class=\"token punctuation\">;</span>\n\nlog<span class=\"token punctuation\">.</span><span class=\"token function\">Information</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Processed {@Position} in {Elapsed:000} ms.\"</span><span class=\"token punctuation\">,</span> position<span class=\"token punctuation\">,</span> elapsedMs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>If you configure Serilog correctly, you can get it to output it's logs to JSON format, so the above line would log the following:</p>\n<div class=\"line-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Timestamp\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2015-12-07T12:26:24.0557671+00:00\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Level\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Information\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"MessageTemplate\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Processed {@Position} in {Elapsed:000} ms.\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"RenderedMessage\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Processed { Latitude: 25, Longitude: 134 } in 034 ms.\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"Position\"</span><span class=\"token operator\">:</span> \n    <span class=\"token punctuation\">{</span> \n        <span class=\"token property\">\"Latitude\"</span><span class=\"token operator\">:</span> <span class=\"token number\">25</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Longitude\"</span><span class=\"token operator\">:</span> <span class=\"token number\">134</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \n    <span class=\"token property\">\"Elapsed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">34</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ProcessId\"</span><span class=\"token operator\">:</span> <span class=\"token number\">123</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ThreadId\"</span><span class=\"token operator\">:</span> <span class=\"token number\">123</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"User\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Domain\\\\Username\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Machine\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Machine-Name\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Source\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"My Application Name\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1 id=\"why-json\"><a href=\"#why-json\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Why JSON?</h1>\n<p>What can you do with JSON formatted logs that you can't do with plain text? Well, if you store all your logs in something like <a href=\"https://www.elastic.co/webinars/get-started-with-elasticsearch?elektra=home&#x26;storm=banner\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Elastic Search</a>, you can query your logs and ask it questions. So if we take the above example further we could find all log messages from a particular machine or user with an elapsed time of more than 10 milliseconds and a distance of 10 Km away from the specific location.</p>\n<p>Not only that but if you set up something like <a href=\"https://www.elastic.co/products/kibana\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Kibana</a>, then you can create visualisations for your logs which could grow to be gigabytes in size over time. You can create dashboards with cool charts and maps that look something like this:</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1337 753' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-3f1948529a6428611389c19acbe81072'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-3f1948529a6428611389c19acbe81072)' width='1337' height='753' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAkCAIAAAC2bqvFAAAACXBIWXMAAAsSAAALEgHS3X78AAAPBElEQVRYw71Y%2bZNc1XXuPyC/O45TlYAUjGa0sUigpCoGKoVJADu4yoAxTpzYgYBlkdhiE2iM5BjH2HJSBgR2wC4hC6EFCbFoBkkItICQNJqtp/e37/va/fr1Ovnuez2t1gKGxMmdU3fuu%2b/0vefc853lvszIlut3rv/JmV/uWzvy6LuHD4%2bMjKxZs2bjxg3r1z/%2bwANrNmx44oYbbli0aNGSJUsWL168cOHCRZdfvnTp0qGhy5dfefUtt91585dvv%2bXLt//VF7%2b0aGjRsmXLhoeHFy5c8GlpwYJLh4aG0i2w%2bPLlyzHAIxbEYBg0PAyGdHJoeJj8W7IEnCuvuSaz7tfXbb7v4cqOoy9s37p3z2vPPLv51T17jxw5tmnTz7e9vP3tAwdvvPGmz33uj8G/ZNlyDC655NJly68YGhpeeNnQjX/zlVtvu/OWv73jL75w45/86SXLr7hy8ZKln/3sH31a%2bsxn/nDBgoVLly1fsnTZ0PBi0GWXfR5bYNMVK1ZcffWKa1etuvbaVStXXnPVVVddceWVV1119YoVK1esXHnd9Tdk/u0/NmZPTZYm8rPFEsPypTJVrtA0w5348BTGmHnvyLH9o2%2b/%2bdYoaHTswP7RsWS8/8DBwwffOfLOu0fRg/AKkynP/4De2j%2bW/hz01v7RfW%2b8tX3n7meff%2bGrX/vHu7953x1f/zb62%2b/61t1//89pf%2bfd93z97%2b696xv3ZH781PNeWHX8wPMCx/Vdz3dArh%2bENTcZ1KJ6PW7GCdXjRm/caGI2iuKo3iO8wiSZJzyNer3RG3xiiud3AXlhjRak4ycnvn3fw2u%2b/8S9qx9ds/aJf7r/4e/%2b6wj6%2bx947J7vPLL6eyNr1v4gc3pyenImN5XNT4Jmcul4an4MOjOV7dH0APVmZgdogG0qOzE9OzHTm5ycnsU6eCQ95pPHlNJxOnkeTecK6E9NTJ86M3VqYurk%2bCRExfj0xPRJ0s9g/OH4ZCZqNDzfNW3TtC3bsT3ftx3L9VzH82zXbTQanXar3W63Ws20tUhL%2b3TQbM1PdkhrN5sNsNu2pWlqtVaL4joWJIu7DnrLwci2k143dMd1bcdpNBvNC6jRiLFdm%2bx%2bITUtiyxTb8QZ09Jt27AcghpV0yVZMWxPM21RFARRUDUFciiKDIEIyjwXPzMtwzB1ECSzHMtxIZfpeg7LsTzHBYGn6RrHs0Q%2bz/PDMKxW%2bxSAwqRVq34QAKlgIHomDYOwVqsmlE5Vq73HHkU1/JmGKYqirmleEGR0QzMMTRJKHHW6mJ/kNWgjazovqxIn0LzISAqvaKJmSBiruqQbsqwKDFeZzU9j3nJ0y9ZkhZdkDvycwLi%2bSbPlXHFGkBnbtesxXKU%2bN9A63S5o7ne1Tneum9B5rdaMOF3wHBcHAt/LGJYBa2i57fLRf7HLuxit5sw%2b4xZeLNIsRRd0U6WYCgSFGhBL02XDUhmOgvT5YtaE6KpAMWWoh3moh0fdVBi2wol0mSrCPlEc45ixcTeRpRq3dk2U9%2beYVmuuovsnWT0r2ccqMh6tMPrl8endZ6hx3thxpvTciZP7csX1%2b4%2b8OlX%2bgBOKqvf8sexpXnWjWl7XespE9YwBcDiupjKalDUMUdJNXZ4RmXFRFhi%2bIsoc5BYVThAZlqPwCGVEmaUYKFgSZOBE7svN8oQBMIQyuinbruEFPolRiQXa3Q76I1Ju1cvrb9rzo5u2Pf3FHT%2b77tXHr9%2b5ccW2dWsPv/Lk6Z3X7Vl3yXNrV708cukvRlbtfPBLbz%2b%2bZNvq20Y3/OWr6/7s5/%2b%2b7NeP//mWH89Iei1upsdBFLC8IJvLi6qp%2bQ1NKYbF51S5wvAs5KswRcAGx0wxpezsVIUq8hKTK8xIKg/kwBqCxHICJau8Zsp4BQVSQ4EwhlkCAL5WCwYs4Db9PeKh/fIxqa5NOPn3jFMnrKlD2gkjttlQ3sK8vkc6cNQc38Ed2FzatZM/%2bFTuN3uFd/bLx09Zs9u4Nw7IJ9vtzlk4QQHNchiWEVWN4jVZmA3p3ypSyXJNnGW5kq/QxcQIFaKJBTiVCqXZ1BmAE1HmRYmjuQoQX6rkYZnUPoouSjLxCvi3pGpw0lSBVIdmp9VoNy8O/AHEg63daad2671Mft4dcAuigIxgYepu4DjS8dDOT2SLxXLBcQ3bMZKzL%2bOMcZY4UYouGRbARM/mZ6AY/FjVRTwW4bHlXIUusXwF8xiLCtEB9kFitJKkOChhQqkQ3dShU5/uTSWT3bnuoKCd3iOZR6g%2bRwHTsWF3WVX8/Gan/AonIrCoOFdB4iAu0A8RIVaCFhrz5UoBykB6WAanPjF5mhcYBXGJLZUquUIJ0nOqLlTYItTzAg8%2bEITVwVPGoXbnRe9FGjLutJOJTvfsI6gzP9khYzJAUjoXQnBahVfRqRxP4iANZ%2bUTWYETQALST2cngBxAopJAKJUegpaoPLwZP4dNpmcmiuU8zVRgKCCtCFhVcpZrIwohpM/9/tqFFnBkRTRMFUEDkQRnKYoswAPYYAy4QyU4JWRiuUqxPIvoiWBPM2VABXUArOeFTqlcKBZznm8j%2bBimgigEK8E%2baRjt%2bwDZsl3fQR%2bRq7ZU05lQthp%2b1GlwoXJMzo3rlBV7M6piRP60Qx3m8%2b/znBKZcmRRrpGzxNMqY0WhX6/18UYU0CG4bUFWWREQWwSRlWVO1UTXtxAlGURGicOhlsp5VqByhWyxlKOBHbqAGIVsAA0tx7BsFAUG2MCsGbKkcDgCRRMcz0kKu7ivgF3zdlUOyVUD0hcdjrZFtx6IkX5CK3yozEqhUbRVIwrG9cIhZup9nmEDhXLFaYWdMekzRkUO3AsUcDyZpDLD8UxeoMoM4xb%2byyq8RLECjzwgMbws64Vt/IdPFcqlQjErSgiaKo6/UMoCPI6HRMAjtnI8DYkBMzpxbmgiSixqHpQ1g2GkHsXdZg8D7Wa7Xos7iDWNdqMah27oe2Gn2apHkW8H7bjdZ2vVG8RxLmipAq5me0hbOHviAALrCEcs4bhhmzhdAIZiGZP/wBPf0y1d0RTD8TXbp5An4DAiHKYC4CFSJd5Syuamy1QBuOJEBhBCmm8gx54fKpNgMl8loA%2bqNcf3w1rVJ8VSzQ%2brXhi2CdhTRz9bgKR%2bf44COHnZtIAHKIB44geoy1xJU/QEyoCWovGippZoWkfK5sbM2Rcl01MsV9Y0uAQcGmqXqTxcPzs7DehXmAJyHAyCGdSeqIVIjZrSfDGZtn5t2YuR0CQIUMOl4rYvYBtseMSyYS0iiQypwLRVBH64AeyuagLKAWwvySwOuFAqyCiJLEvSdSb7mpLdKqgGqe9UQ9VknD0cGrEIHkJqCoVjBNZUcqEj2g6SgOUGoev7PUKlGoYXoSBIq3fcqwh5Hij9iYPC3nW9834YBGAm/J6f4SUJwRtxE9HDcU0cPOrQCsOxAnqaEUTF8gwvlAxb1jVZUwSFqEqqU8M23EBUVZHUoUjVNPIXlC8LjD59vMbk7SB0HAvFs4amI04rKMUj1MmkRD6HqmGI8liSJA8lu%2b8rqgpmXddR5mALCzxxHTw9frJAVVEUTVV9Uk5bBpI/lwC6WJpFNuUlsURzHFZwQ80JQIplV1iWV3SUGJatIMfBs2lRVUwHOVzUDVElKRkuTjMlWqiIlZIhiYqhWraFC2kzuZ7024WP6QzuRAi4qPzSRyDKZIvC1EF%2b7O1Ys%2bD4vd/GDVKHydBRgZEzgCmMpqgSwgtAD8cVZJR2DpwV2huub/vVkmqhZMMvgKUZXp1iBJL4CMAEhH3KDCjdKygmLck0XWEYSjAM2rCQyeGUcaPxyZMU0nY/ahX27N731w%2b/tvZX33v23hcevMeezqcuX21FlM7hGg4TlSkqA53hQuntMPUe4i6dTprS09bq9DI8rAc8dgkbPJLcJMHYIg7aJZQUAanLptGj3mjUBxTAnOu6uI2ZpgnA4Ah93z9fgYQ/1Ol9dz12/Nbje78z%2brXJH945uvr1px6aSyKpWa3NygopbF23UCpn4FghuchF1SgK0xtdRMZBev1LCOgjg1qNOJPv9%2bYT5v7b3nWxWgt6k%2bQtFk8V6M5XAWNjYzt37tyyZQv6rVu3Hjp0aLDAhAJxTPjp0b0jN7%2b06ab3t6x54443n1yx42cP/fSxFkMR3WotQSVq4xacKxYzqBU1Q5dVVYJT6DrulwKQYhjVT9mSW26v4S4LvwVMEUzicy2AgzcMg6IovOV5RBBpsLZJFCBpu7j7ldXLf/EPXzj64CNnLn3kV5nv/udX77i/WS6SO53fFFgbYRacEDvjJxvjXOOIVF3IgvVqBKvU68li5zVMpnRBa%2bKPvMECkes4gAcu3QhB9Yv5AHYEAC7qA6nCNZnZ/JVHV38/%2b9DT%2bi2bTv/BN9fuemRdytMI2hbvdwmKO4hamShJNM249aZ0TK95oue8q4%2bfd2/4JM1vhf3LB%2bRD8A4S/JynQJqGOukXmKR9lBOrhcl3t7/w5JoXN9z/9LaNP61zTE8BN7BpgQzihmFauBM7JNLF7WfK24%2bV%2bZ/snnieeYXjW4YbJ6jtF%2bjpbWhuMJMP3qKyhhyQrx418kEnTj/ptCFNPYHEeS0NoB8ThXrHFzvm6ePWxKm4WmvPf6Jo1es110nPApkuoxomMAsL/Ibdc5KSf/jyme3Ka3tGnTxdTb9t/M6WspRl30JlZ%2bhO0izLCgDLZhORtIYtBwg2T7MsuSqc%2bwpVEGJAOiZfgeJW3J2Dopbne17CD4DCqs1Wug4Wz4RRBJOi9NuU/%2b3I60c37Z65%2bY0f3fqDY3uzE3SgjM/6U25JNWNa86JOFFY7ThzEzbYfNaJ2HYE3ajVIKO10a1EH%2bI0iskU9acQQjYbpehcSBAJd9NUgGY6ro1JHOhzkR%2bGOkmGeJ1Ml3zzg050Zi37pg%2bmK5I0xU2Pj8qzJFXR5puJPOkVWqhZUw6jbqt5gfNlwq6zuSaGmG7HgG5qPMubi2Qp46Iv7v6GPWSRV4COwkQAorjdcz8WtxHFwwY36l7rUF/uPKWj7rp8Ofl8KfAz1FOimN/9EjsRr5/r1eqPVTL%2beRySKAjat3jeSubO1%2bUdFrP8PBeA0Z2tutH4/MEiq%2bXZSStQ8z2u1O%2bd8LO7zn0v4FXT%2bv1bgvwG/nIJooHujTgAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"1337\" alt=\"Kibana Dashboard Screenshot\" data-srcset=\"/assets/static/Kibana-Screenshot.82a2fbd.e96a2ce391412a40cdad4ce9201011d6.png 480w, /assets/static/Kibana-Screenshot.cbab2cf.e96a2ce391412a40cdad4ce9201011d6.png 1024w, /assets/static/Kibana-Screenshot.067a82c.e96a2ce391412a40cdad4ce9201011d6.png 1337w\" data-sizes=\"(max-width: 1337px) 100vw, 1337px\" data-src=\"/assets/static/Kibana-Screenshot.067a82c.e96a2ce391412a40cdad4ce9201011d6.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/Kibana-Screenshot.067a82c.e96a2ce391412a40cdad4ce9201011d6.png\" width=\"1337\" alt=\"Kibana Dashboard Screenshot\"></noscript></p>\n<h1 id=\"logging-exceptions\"><a href=\"#logging-exceptions\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Logging Exceptions</h1>\n<p>One major problem with all exceptions is that they do not log all the properties of an exception and throw away vital information. Take the <code class=\"language-text\">DbEntityValidationException</code> from EntityFramework as an example. This exception contains vital information buried not in the message but in a custom property called <code class=\"language-text\">EntityValidationErrors</code>. The problem is that when you do an <code class=\"language-text\">exception.ToString()</code> call, this vital information is not included in the resulting string. Even worse, it's not included in the debugger either. This is a pretty major failing in the .NET framework but alas we have to work around it.</p>\n<p>There are literally dozens of questions on <a href=\"https://stackoverflow.com/questions/15820505/dbentityvalidationexception-how-can-i-easily-tell-what-caused-the-error\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">StackOverflow</a> asking how to deal with this problem and all the major logging frameworks fail in this regard. All of them call <code class=\"language-text\">exception.ToString()</code> and fail to log the <code class=\"language-text\">EntityValidationErrors</code> collection.</p>\n<p><code class=\"language-text\">DbEntityValidationException</code> is not the only culprit, half the exceptions in the .NET framework contain custom properties that are not logged. The <code class=\"language-text\">Exception</code> base class itself has a <code class=\"language-text\">Data</code> dictionary collection which is never logged either.</p>\n<h1 id=\"serilogexceptions\"><a href=\"#serilogexceptions\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Serilog.Exceptions</h1>\n<p>I wrote <a href=\"https://github.com/RehanSaeed/Serilog.Exceptions\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Serilog.Exceptions</a> to solve this problem. So what happens when you log a <code class=\"language-text\">DbEntityValidationException</code> using this NuGet package added to Serilog itself? Well take a look yourself:</p>\n<div class=\"line-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Timestamp\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2015-12-07T12:26:24.0557671+00:00\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Level\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Error\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"MessageTemplate\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hello World\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"RenderedMessage\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hello World\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Exception\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"System.Data.Entity.Validation.DbEntityValidationException: Message\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"ExceptionDetail\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"EntityValidationErrors\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"Entry\"</span><span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"ValidationErrors\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n              <span class=\"token property\">\"PropertyName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PropertyName\"</span><span class=\"token punctuation\">,</span>\n              <span class=\"token property\">\"ErrorMessage\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PropertyName is Required.\"</span><span class=\"token punctuation\">,</span>\n              <span class=\"token property\">\"Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"System.Data.Entity.Validation.DbValidationError\"</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"IsValid\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"System.Data.Entity.Validation.DbEntityValidationResult\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Message\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Validation failed for one or more entities. See 'EntityValidationErrors' property for more details.\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"InnerException\"</span><span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"TargetSite\"</span><span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"StackTrace\"</span><span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"HelpLink\"</span><span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Source\"</span><span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"HResult\"</span><span class=\"token operator\">:</span> <span class=\"token number\">-2146232032</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"System.Data.Entity.Validation.DbEntityValidationException\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ProcessId\"</span><span class=\"token operator\">:</span> <span class=\"token number\">123</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ThreadId\"</span><span class=\"token operator\">:</span> <span class=\"token number\">123</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"User\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Domain\\\\Username\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Machine\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Machine-Name\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Source\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"My Application Name\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It logs every single property of the exception and not only that but it drills down even further into the object hierarchy and logs that information too.</p>\n<p>You're probably thinking it uses reflection right? Well...sometimes. This library has custom code to deal with extra properties on most common exception types and only falls back to using reflection to get the extra information if the exception is not supported by Serilog.Exceptions internally.</p>\n<h1 id=\"getting-started-with-serilogexceptions\"><a href=\"#getting-started-with-serilogexceptions\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Getting Started with Serilog.Exceptions</h1>\n<p>Add the Serilog.Exceptions NuGet package to your project using the NuGet Package Manager or run the following command in the Package Console Window:</p>\n<div class=\"line-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">Install<span class=\"token operator\">-</span>Package Serilog<span class=\"token punctuation\">.</span>Exceptions</code></pre></div>\n<p>When setting up your logger, add the <code class=\"language-text\">WithExceptionDetails</code> line like so:</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">using</span> Serilog<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> Serilog<span class=\"token punctuation\">.</span>Exceptions<span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">ILogger</span> logger <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LoggerConfiguration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span>Enrich<span class=\"token punctuation\">.</span><span class=\"token function\">WithExceptionDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span>WriteTo<span class=\"token punctuation\">.</span><span class=\"token function\">Sink</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RollingFileSink</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">@\"C:\\logs\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">JsonFormatter</span><span class=\"token punctuation\">(</span>renderMessage<span class=\"token punctuation\">:</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">CreateLogger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That's it, it's one line of code!</p>\n"}},{"node":{"title":"Model-View-ViewModel (MVVM) – Part 4 – INotifyDataErrorInfo","path":"/model-view-viewmodel-mvvm-part4-inotifydataerrorinfo/","date":"9 September 2014","timeToRead":13,"description":"An base class implementation for the INotifyDataErrorInfo interface. Used in the Model-View-ViewModel (MVVM) pattern. Targeted for best performance.","content":"<ul>\n<li><a href=\"/model-view-viewmodel-mvvm-part1-overview/\">Model-View-ViewModel (MVVM) - Part 1 - Overview</a></li>\n<li><a href=\"/model-view-viewmodel-mvvm-part2-idisposable/\">Model-View-ViewModel (MVVM) - Part 2 - IDisposable</a></li>\n<li><a href=\"/model-view-viewmodel-mvvm-part3-inotifypropertychanged/\">Model-View-ViewModel (MVVM) - Part 3 - INotifyPropertyChanged</a></li>\n<li><a href=\"/model-view-viewmodel-mvvm-part4-inotifydataerrorinfo/\">Model-View-ViewModel (MVVM) - Part 4 - INotifyDataErrorInfo</a></li>\n</ul>\n<p>In this next part, I'm going to discuss validation of your view models using the <a href=\"http://msdn.microsoft.com/en-us/library/system.componentmodel.inotifydataerrorinfo%28v=vs.110%29.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">INotifyDataErrorInfo</a> interface. Validation is an often ignored part of the Model-View-ViewModel (MVVM) story. If you need to create a form for your users to fill in (which is probably most applications, I would have thought), then you probably need to validate user input in some way and the <a href=\"http://msdn.microsoft.com/en-us/library/system.componentmodel.inotifydataerrorinfo%28v=vs.110%29.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">INotifyDataErrorInfo</a> interface can get you there.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 250 80' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-b1f8b4ee0775bda64008d9d31b6c6f23'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-b1f8b4ee0775bda64008d9d31b6c6f23)' width='250' height='80' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAUCAIAAACyFKxoAAAACXBIWXMAAAsSAAALEgHS3X78AAACQklEQVRIx%2b1VW6sSURj1ZwQVFfRfeughCvoHCb0m%2bRCnelTR0KejRg957SW8YArHG1qohOINRAXF25m862iOHh11TsvZByHOITxGHaJZD3v23vPNN2ut79szotN/HKJdgqbT6Xg8/n4VwHtZlt1TAMdxGCeTSTabbTabjUbjmAdFUcc741LB55%2btVCrFYnFLhozfRhRFU2R5JmDN40IBo9EI1LfLv4zlclkul8nbCYHpgnn87uH9w3sn7MmmAqvVCheLxaLX65PJ5GAwgNkQ3e12MSF17HQ6iUQCMa1WCwFOpxPe9Ho9zJEdGWq1msvlQrnb7TYE9/t93EXpSqWS2%2b0mPNaXBxgvFgskQQZ/wffq0wGzYJ5%2beHLr4Lrx6/uzChABR0dHUqlUJpNJJBK5XK5SqTQajVgsjsVi8/kchDwej06ngwa1Wm02m00mk9FoVCgUWq02lUqBusPhCIVCeFapVBoMBmSwWq3YtNvtpMJ7V6BU3ggA%2bzsvbz56%2b%2bDu69u6L4fbjhCRC8yG0M88CoVCvV6HtZFIBMxgJIyv8PD5fOFwGPWJx%2bM2mw3uptPparU6m81ggd/vR3G8Xm8mkwkEAvl8PhgMRqPR3xRAWohdsc9tz268uKYOvtkk5NbcKffTIT7f4mQHGnK5HMMwNE2jnWgeRBiAhsESDYMRMQjA5nA4xATjiEd/X6BF4R0MJXzoGW1LfVyulvxp4Hb9jMI8nAEkal8FyDn8xSdE9F/8yAQBggBBgCBAECAIEAT8IfwAQ0BrByykQ34AAAAASUVORK5CYII=' /%3e%3c/svg%3e\" width=\"250\" alt=\"INotifyDataErrorInfo Valid TextBox\" data-srcset=\"/assets/static/Valid.0f04e74.1bbb87ab75dd7e4a412c06aac201dfc7.png 250w\" data-sizes=\"(max-width: 250px) 100vw, 250px\" data-src=\"/assets/static/Valid.0f04e74.1bbb87ab75dd7e4a412c06aac201dfc7.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/Valid.0f04e74.1bbb87ab75dd7e4a412c06aac201dfc7.png\" width=\"250\" alt=\"INotifyDataErrorInfo Valid TextBox\"></noscript>\nINotifyDataErrorInfo Valid TextBox</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 250 80' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-1b55166779042cbf76cef5763aed867b'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-1b55166779042cbf76cef5763aed867b)' width='250' height='80' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAUCAIAAACyFKxoAAAACXBIWXMAAAsSAAALEgHS3X78AAAD0ElEQVRIx9VWS3PaVhRm0W1X3fQfdNvptv%2bgneminf4Eb7twx/0HtWfiZpzEdcYTd2xDMA7GSQE/wEn84pHGjklFeMgxQrIEkrBAiKInet1eSenUTplJJwU6/uZDI6R77j3fPeeeIx%2b45vD9m0Et1WQkk5X/B9KSqRg29MF%2bDwG2a3Qhm2tpPJ8njl8SL34fKXMIkTrCtgtN6IZlmY430jFoh13nrCsCLBd9BdS7BpwLMKRFkaA2WtZJDcf3S5zrsCsA%2bxogHwNL8xx0BJim8yIYDM7Pz%2bdyOZ7nGYY5PT3lOI5hWbnbYRX7%2bQkOKLKHkwYxUlrnpHSG73kC4E%2bIAuwbQH0Paj%2b4/ht/C0gmkxMTE5OTk%2bPj41NTU9PT0zMzM2NjY0fZdNsERydVuBlwOkCOlhSpYfh%2b%2bS8Bpc/A2ReA%2bRGcfAB01ksdn%2b0mCtz1SqVy6AJFUZIkMQzLZDJSp91Q7BcIAVjKqlGgPlrSlEYQ%2b%2bWGI4APg2c%2bUPoUVL4CWR8gv3ODYPouZbzd9wwwohFLY1Sx%2bjpfrbzqQ6yAn5epYZBCKRQhEgUnAhbxLch/CNDPQeVLgHwEip94QXh3GTUtu3ShvGKVQqM/EVpMofQwmEbpvVK9THF/dPhWs67IIrAV2%2bw6JQieY%2b8M/Jcm4gWNZWgCO%2bvwzdYFy3ONgZNrsDDD63Umny/Z4O2WMAAB9Xq93W73TcLBolgs6rr%2bPp34nQJEscs1GLxKNFqCbahV7PyyHkPXTbfJGCbMR9u5Qhh6q8n3NAU/q5pXWy18rxsGNIe1v8U1Nd10J7NLpdKQBNQkWWmco4FgKJtJLS4uBFdWcyf5RGRtwR/pdNqpw9TL4%2bzSsj%2byuhaPb64EQjvJp4mNhzdu3mL5ln/h5%2b3kztydu1RTePIovHR/9UEgcD8U3t5IxB%2bt/3TzxvbuAVIowO%2bJcnk4AmiaFjpdoIvx2Eb2cPf2nbnDJ7sBvz/wy%2bJyOC7w3E4i%2bXgrfuv23LPM882HsdRBJh5ej0bj8dhWSxA2w6FYNDo7O0%2b3hK3Iij8USe%2bljrK/Ld6bvbe0vPf04Nf1B4/Tx3ChQqEwFAHwhAmC4HZ72w21cwtXsu03A/SeBrPiiqFl6T3dSSTbNk2YU6Y31rN/sy84xlw406LFfFtUnD42pBSq1WrwGPR6PUkUZVmBkCRJVVVZljVNkyVJUVTVeazIl6C6fxXXQJYld4jzwDOEM2har6epkiRDqSqsoJKEIIhhGIMXIIoibN6vB41TF94NvMIlCIL4Z6HzgWuOAQhwyt1I0LfPXPsI/AkVpvt2a4hVuAAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"250\" alt=\"INotifyDataErrorInfo Invalid TextBox\" data-srcset=\"/assets/static/Invalid.0f04e74.84d40fcd0522512f58367ee0a7ab90f2.png 250w\" data-sizes=\"(max-width: 250px) 100vw, 250px\" data-src=\"/assets/static/Invalid.0f04e74.84d40fcd0522512f58367ee0a7ab90f2.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/Invalid.0f04e74.84d40fcd0522512f58367ee0a7ab90f2.png\" width=\"250\" alt=\"INotifyDataErrorInfo Invalid TextBox\"></noscript>\nINotifyDataErrorInfo Invalid TextBox</p>\n<p>In the example above you can see a name text box which requires text, to be in a valid state. In the valid state there is a big green tick next to the text box and conversely in an invalid state, there is a big yellow warning sign, the text box background becomes pink and you get a nice tool-tip telling you what the error is. By the way, this example is taken from my <a href=\"https://github.com/RehanSaeed/Elysium-Extra\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Elysium Extra</a> WPF project which is freely available on GitHub.</p>\n<h1 id=\"how-does-it-work\"><a href=\"#how-does-it-work\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>How Does It Work?</h1>\n<p>You can see the interface and its corresponding event arguments below. If the name property in our view model changes and is empty then the state of our view model is invalid, we can raise the <code class=\"language-text\">ErrorsChanged</code> event, set the <code class=\"language-text\">HasErrors</code> property to return true and make any calls to <code class=\"language-text\">GetErrors</code> return a list of the errors (In our case we only have one but there could be multiple errors).</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">namespace</span> System<span class=\"token punctuation\">.</span>ComponentModel\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">INotifyDataErrorInfo</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">bool</span> HasErrors <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">event</span> EventHandler<span class=\"token operator\">&lt;</span>DataErrorsChangedEventArgs<span class=\"token operator\">></span> ErrorsChanged<span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">IEnumerable</span> <span class=\"token function\">GetErrors</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DataErrorsChangedEventArgs</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">EventArgs</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">public</span> <span class=\"token function\">DataErrorsChangedEventArgs</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">string</span> PropertyName <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That's a fair amount of work and a base class to do all that makes life much easier. So what are the main aims of a base class implementing <code class=\"language-text\">INotifyDataErrorInfo</code>?</p>\n<ul>\n<li>Integration - I usually want to raise an error in response to a property changing. So, we probably want to also implement <code class=\"language-text\">INotifyPropertyChanged</code>. Handily, I showed how best to create a base class for that in my last article in this series. So our new base class can inherit from the <code class=\"language-text\">NotifyPropertyChanges</code> base class.</li>\n<li>Performance – Performance is king. It needs to be fast and I mean really fast. You can't afford for your UI to freeze up while your view model works out if it has an error to raise or not. Some validation frameworks use an attribute based approach but this requires reflection so we will not be using that here.</li>\n<li>Reactive Extensions (Rx) – Events are old school, I want an observable error changed event notification system instead of the <code class=\"language-text\">ErrorsChanged</code> C# event.</li>\n<li>Human Error – I don't want to raise error change events for properties that don't exist by accident.</li>\n<li>Has it Really Error'ed – I don't want to raise a error changed event twice by accident or if it has not really error'ed.</li>\n</ul>\n<p>So, without further ado, here is my implementation. Note that there are three classes:</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">namespace</span> Framework<span class=\"token punctuation\">.</span>ComponentModel\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>ComponentModel<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Diagnostics<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Linq<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Reactive<span class=\"token punctuation\">.</span>Linq<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Reflection<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Runtime<span class=\"token punctuation\">.</span>CompilerServices<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> Framework<span class=\"token punctuation\">.</span>ComponentModel<span class=\"token punctuation\">.</span>Rules<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Provides functionality to provide errors for the object if it is in an invalid state.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token comment\">/// &lt;typeparam name=\"T\">The type of this instance.&lt;/typeparam></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NotifyDataErrorInfo</span><span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> <span class=\"token punctuation\">:</span> NotifyPropertyChanges<span class=\"token punctuation\">,</span> <span class=\"token class-name\">INotifyDataErrorInfo</span>\n        <span class=\"token keyword\">where</span> T <span class=\"token punctuation\">:</span> NotifyDataErrorInfo<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">string</span> HasErrorsPropertyName <span class=\"token operator\">=</span> <span class=\"token string\">\"HasErrors\"</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> RuleCollection<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> rules <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token generic-method\"><span class=\"token function\">RuleCollection</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">private</span> Dictionary<span class=\"token operator\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">,</span> List<span class=\"token operator\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token operator\">>></span> errors<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Occurs when the validation errors have changed for a property or for the entire object. </span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token keyword\">event</span> EventHandler<span class=\"token operator\">&lt;</span>DataErrorsChangedEventArgs<span class=\"token operator\">></span> INotifyDataErrorInfo<span class=\"token punctuation\">.</span>ErrorsChanged\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">add</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errorsChanged <span class=\"token operator\">+=</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">remove</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errorsChanged <span class=\"token operator\">-=</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Occurs when the validation errors have changed for a property or for the entire object. </span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">event</span> EventHandler<span class=\"token operator\">&lt;</span>DataErrorsChangedEventArgs<span class=\"token operator\">></span> errorsChanged<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Gets the when errors changed observable event. Occurs when the validation errors have changed for a property or for the entire object. </span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;value></span>\n        <span class=\"token comment\">/// The when errors changed observable event.</span>\n        <span class=\"token comment\">/// &lt;/value></span>\n        <span class=\"token keyword\">public</span> IObservable<span class=\"token operator\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token operator\">></span> WhenErrorsChanged\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">get</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> Observable\n                    <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">FromEventPattern</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DataErrorsChangedEventArgs</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>\n                        h <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errorsChanged <span class=\"token operator\">+=</span> h<span class=\"token punctuation\">,</span>\n                        h <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errorsChanged <span class=\"token operator\">-=</span> h<span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">Select</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">=></span> x<span class=\"token punctuation\">.</span>EventArgs<span class=\"token punctuation\">.</span>PropertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Gets a value indicating whether the object has validation errors. </span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;value>&lt;c>true&lt;/c> if this instance has errors, otherwise &lt;c>false&lt;/c>.&lt;/value></span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">bool</span> HasErrors\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">get</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">InitializeErrors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">.</span>Count <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Gets the rules which provide the errors.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;value>The rules this instance must satisfy.&lt;/value></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">static</span> RuleCollection<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> Rules <span class=\"token operator\">=></span> rules<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Gets the validation errors for the entire object.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;returns>A collection of errors.&lt;/returns></span>\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">IEnumerable</span> <span class=\"token function\">GetErrors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetErrors</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Gets the validation errors for a specified property or for the entire object.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyName\">Name of the property to retrieve errors for. &lt;c>null&lt;/c> to </span>\n        <span class=\"token comment\">/// retrieve all errors for this instance.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;returns>A collection of errors.&lt;/returns></span>\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">IEnumerable</span> <span class=\"token function\">GetErrors</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> propertyName<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Assert</span><span class=\"token punctuation\">(</span>\n                <span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n                <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetRuntimeProperty</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"Check that the property name exists for this instance.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">InitializeErrors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">IEnumerable</span> result<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                List<span class=\"token operator\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token operator\">></span> allErrors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token generic-method\"><span class=\"token function\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span>KeyValuePair<span class=\"token operator\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">,</span> List<span class=\"token operator\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token operator\">>></span> keyValuePair <span class=\"token keyword\">in</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{</span>\n                    allErrors<span class=\"token punctuation\">.</span><span class=\"token function\">AddRange</span><span class=\"token punctuation\">(</span>keyValuePair<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n\n                result <span class=\"token operator\">=</span> allErrors<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">else</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">.</span><span class=\"token function\">ContainsKey</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{</span>\n                    result <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">[</span>propertyName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword\">else</span>\n                <span class=\"token punctuation\">{</span>\n                    result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token generic-method\"><span class=\"token function\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Raises the PropertyChanged event.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyName\">Name of the property.&lt;/param></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">void</span> <span class=\"token function\">OnPropertyChanged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">CallerMemberName</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">string</span> propertyName <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">base</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnPropertyChanged</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">ApplyRules</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">else</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">ApplyRules</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">base</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnPropertyChanged</span><span class=\"token punctuation\">(</span>HasErrorsPropertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Called when the errors have changed.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyName\">Name of the property.&lt;/param></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">OnErrorsChanged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">CallerMemberName</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">string</span> propertyName <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Assert</span><span class=\"token punctuation\">(</span>\n                <span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n                <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetRuntimeProperty</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"Check that the property name exists for this instance.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            EventHandler<span class=\"token operator\">&lt;</span>DataErrorsChangedEventArgs<span class=\"token operator\">></span> eventHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errorsChanged<span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>eventHandler <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">eventHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataErrorsChangedEventArgs</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Applies all rules to this instance.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">ApplyRules</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">InitializeErrors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> propertyName <span class=\"token keyword\">in</span> rules<span class=\"token punctuation\">.</span><span class=\"token function\">Select</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">=></span> x<span class=\"token punctuation\">.</span>PropertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">ApplyRules</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Applies the rules to this instance for the specified property.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyName\">Name of the property.&lt;/param></span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">ApplyRules</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> propertyName<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">InitializeErrors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            List<span class=\"token operator\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token operator\">></span> propertyErrors <span class=\"token operator\">=</span> rules<span class=\"token punctuation\">.</span><span class=\"token function\">Apply</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>T<span class=\"token punctuation\">)</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ToList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>propertyErrors<span class=\"token punctuation\">.</span>Count <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">.</span><span class=\"token function\">ContainsKey</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">[</span>propertyName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword\">else</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">[</span>propertyName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token generic-method\"><span class=\"token function\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">[</span>propertyName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">AddRange</span><span class=\"token punctuation\">(</span>propertyErrors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnErrorsChanged</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">.</span><span class=\"token function\">ContainsKey</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">.</span><span class=\"token function\">Remove</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnErrorsChanged</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Initializes the errors and applies the rules if not initialized.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">InitializeErrors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errors <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Dictionary</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">,</span> List<span class=\"token operator\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token operator\">>></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">ApplyRules</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">namespace</span> Framework<span class=\"token punctuation\">.</span>ComponentModel<span class=\"token punctuation\">.</span>Rules\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// A named rule containing an error to be used if the rule fails.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token comment\">/// &lt;typeparam name=\"T\">The type of the object the rule applies to.&lt;/typeparam></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Rule</span><span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">string</span> propertyName<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">object</span> error<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Initializes a new instance of the &lt;see cref=\"Rule&lt;T>\"/> class.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyName\">The name of the property this instance applies to.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"error\">The error message if the rules fails.&lt;/param></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token function\">Rule</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> propertyName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">object</span> error<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>propertyName <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArgumentNullException</span><span class=\"token punctuation\">(</span><span class=\"token function\">nameof</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArgumentNullException</span><span class=\"token punctuation\">(</span><span class=\"token function\">nameof</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>propertyName <span class=\"token operator\">=</span> propertyName<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>error <span class=\"token operator\">=</span> error<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Gets the name of the property this instance applies to.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;value>The name of the property this instance applies to.&lt;/value></span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">string</span> PropertyName <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>propertyName<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Gets the error message if the rules fails.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;value>The error message if the rules fails.&lt;/value></span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">object</span> Error <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Applies the rule to the specified object.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"obj\">The object to apply the rule to.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;returns></span>\n        <span class=\"token comment\">/// &lt;c>true&lt;/c> if the object satisfies the rule, otherwise &lt;c>false&lt;/c>.</span>\n        <span class=\"token comment\">/// &lt;/returns></span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">bool</span> <span class=\"token function\">Apply</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">namespace</span> Framework<span class=\"token punctuation\">.</span>ComponentModel<span class=\"token punctuation\">.</span>Rules\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Determines whether or not an object of type &lt;typeparamref name=\"T\"/> satisfies a rule and</span>\n    <span class=\"token comment\">/// provides an error if it does not.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token comment\">/// &lt;typeparam name=\"T\">The type of the object the rule can be applied to.&lt;/typeparam></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">sealed</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DelegateRule</span><span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> <span class=\"token punctuation\">:</span> Rule<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">private</span> Func<span class=\"token operator\">&lt;</span>T<span class=\"token punctuation\">,</span> <span class=\"token keyword\">bool</span><span class=\"token operator\">></span> rule<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Initializes a new instance of the &lt;see cref=\"DelegateRule&lt;T>\"/> class.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyName\">>The name of the property the rules applies to.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"error\">The error if the rules fails.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"rule\">The rule to execute.&lt;/param></span>\n        <span class=\"token keyword\">public</span> <span class=\"token function\">DelegateRule</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> propertyName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">object</span> error<span class=\"token punctuation\">,</span> Func<span class=\"token operator\">&lt;</span>T<span class=\"token punctuation\">,</span> <span class=\"token keyword\">bool</span><span class=\"token operator\">></span> rule<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">:</span> <span class=\"token keyword\">base</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rule <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArgumentNullException</span><span class=\"token punctuation\">(</span><span class=\"token function\">nameof</span><span class=\"token punctuation\">(</span>rule<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rule <span class=\"token operator\">=</span> rule<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Applies the rule to the specified object.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"obj\">The object to apply the rule to.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;returns></span>\n        <span class=\"token comment\">/// &lt;c>true&lt;/c> if the object satisfies the rule, otherwise &lt;c>false&lt;/c>.</span>\n        <span class=\"token comment\">/// &lt;/returns></span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">bool</span> <span class=\"token function\">Apply</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> obj<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">rule</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">namespace</span> Framework<span class=\"token punctuation\">.</span>ComponentModel<span class=\"token punctuation\">.</span>Rules\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>ObjectModel<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// A collection of rules.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token comment\">/// &lt;typeparam name=\"T\">The type of the object the rules can be applied to.&lt;/typeparam></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">sealed</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RuleCollection</span><span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> <span class=\"token punctuation\">:</span> Collection<span class=\"token operator\">&lt;</span>Rule<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">>></span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Adds a new &lt;see cref=\"Rule{T}\"/> to this instance.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyName\">The name of the property the rules applies to.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"error\">The error if the object does not satisfy the rule.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"rule\">The rule to execute.&lt;/param></span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> propertyName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">object</span> error<span class=\"token punctuation\">,</span> Func<span class=\"token operator\">&lt;</span>T<span class=\"token punctuation\">,</span> <span class=\"token keyword\">bool</span><span class=\"token operator\">></span> rule<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token generic-method\"><span class=\"token function\">DelegateRule</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">,</span> rule<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Applies the &lt;see cref=\"Rule{T}\"/>'s contained in this instance to &lt;paramref name=\"obj\"/>.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"obj\">The object to apply the rules to.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyName\">Name of the property we want to apply rules for. &lt;c>null&lt;/c></span>\n        <span class=\"token comment\">/// to apply all rules.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;returns>A collection of errors.&lt;/returns></span>\n        <span class=\"token keyword\">public</span> IEnumerable<span class=\"token operator\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token operator\">></span> <span class=\"token function\">Apply</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> obj<span class=\"token punctuation\">,</span> <span class=\"token keyword\">string</span> propertyName<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            List<span class=\"token operator\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token operator\">></span> errors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token generic-method\"><span class=\"token function\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span>Rule<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> rule <span class=\"token keyword\">in</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> rule<span class=\"token punctuation\">.</span>PropertyName<span class=\"token punctuation\">.</span><span class=\"token function\">Equals</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rule<span class=\"token punctuation\">.</span><span class=\"token function\">Apply</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">{</span>\n                        errors<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>rule<span class=\"token punctuation\">.</span>Error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">return</span> errors<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1 id=\"simple-example\"><a href=\"#simple-example\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Simple Example</h1>\n<p>An example of how you can use this base class is as follows.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ZombieViewModel</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">NotifyDataErrorInfo</span><span class=\"token operator\">&lt;</span>ZombieViewModel<span class=\"token operator\">></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">string</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> limbsRemaining<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">static</span> <span class=\"token function\">ZombieViewModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        Rules<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token generic-method\"><span class=\"token function\">DelegateRule</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ZombieViewModel</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"Name cannot be empty.\"</span><span class=\"token punctuation\">,</span>\n            x <span class=\"token operator\">=></span> <span class=\"token operator\">!</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Rules<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token generic-method\"><span class=\"token function\">DelegateRule</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ZombieViewModel</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">\"LimbsRemaining\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"A zombie can't have less than zero limbs.\"</span><span class=\"token punctuation\">,</span>\n            x <span class=\"token operator\">=></span> x<span class=\"token punctuation\">.</span>LimbsRemaining <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Rules<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token generic-method\"><span class=\"token function\">DelegateRule</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ZombieViewModel</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">\"LimbsRemaining\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"A zombie can only have up to four limbs.\"</span><span class=\"token punctuation\">,</span>\n            x <span class=\"token operator\">=></span> x<span class=\"token punctuation\">.</span>LimbsRemaining <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">string</span> Name\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">get</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">set</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">SetProperty</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">ref</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> LimbsRemaining\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">get</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>limbsRemaining<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">set</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">SetProperty</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">ref</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>limbsRemaining<span class=\"token punctuation\">,</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you can see, our view model has two properties and as shown in the last post in the series we are using the <code class=\"language-text\">SetProperty</code> method to raise <code class=\"language-text\">PropertyChanged</code> events. The only bit I've added for validation is in the static constructor containing the three validation rules.</p>\n<p>The <code class=\"language-text\">Name</code> property has a single rule applied to it. When the name is empty a validation error is raised. The <code class=\"language-text\">LimbsRemaining</code> property has two rules and when it is less than zero or more than four, validation errors are raised auto-magically.</p>\n<p>Under the covers, each time the <code class=\"language-text\">PropertyChanged</code> event is raised, we apply the corresponding rule relating to the property and if the rule fails, we raise the <code class=\"language-text\">ErrorsChanged</code> event, raise a <code class=\"language-text\">PropertyChanged</code> event for the <code class=\"language-text\">HasErrors</code> property (Which is now true) and finally ensure that any calls to <code class=\"language-text\">GetErrors</code> now returns the error shown in the rule.</p>\n<h1 id=\"extensibility\"><a href=\"#extensibility\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Extensibility</h1>\n<p>The <code class=\"language-text\">DelegateRule&lt;T&gt;</code> class shown above is a really easy way to provide nice, simple rules. If you need something more complex you can create your own rule by inheriting from the <code class=\"language-text\">Rule&lt;T&gt;</code> base class. An example of this could be a custom rule to validate an email address or telephone number.</p>\n<h1 id=\"using-reactive-extensions-rx-to-replace-the-errorschanged-event\"><a href=\"#using-reactive-extensions-rx-to-replace-the-errorschanged-event\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Using Reactive Extensions (Rx) to Replace the ErrorsChanged Event</h1>\n<p>C# events are old school. Reactive Extensions (Rx) provides a cleaner and far more powerful drop-in replacement for C# events. I'm not going to go over the advantages of Reactive Extensions here but you can take a look at a series of blog posts I've done in the <a href=\"/reactive-extensions-part1-replacing-events/\">past</a>.</p>\n<p>We can hide the <code class=\"language-text\">ErrorsChanged</code> C# event by explicitly implementing the interface (Click <a href=\"http://stackoverflow.com/questions/143405/c-sharp-interfaces-implicit-implementation-versus-explicit-implementation\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a> for details on implicit versus explicit implementations of interfaces).</p>\n<p>The <code class=\"language-text\">ErrorsChanged</code> C# event can still be accessed by first casting the object to <code class=\"language-text\">INotifyDataErrorInfo</code>. Validation in XAML languages, which uses this interface continues to work. Our new Reactive Extensions (Rx) observable event called <code class=\"language-text\">WhenErrorsChanged</code> of type? <code class=\"language-text\">IObservable&lt;string&gt;</code> (The string is the property name) is now the default method of subscribing for error changed events and we've hidden away the old C# event.</p>\n<h1 id=\"inotifydataerrorinfo-support\"><a href=\"#inotifydataerrorinfo-support\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>INotifyDataErrorInfo Support</h1>\n<p>The <code class=\"language-text\">INotifyDataErrorInfo</code> interface is supported by most XAML frameworks including WPF, Silverlight and Windows Phone. Currently WinRT does not support the interface at the time of writing but you can bet that they will in future and in the mean time you can use the <a href=\"https://winrtxamlvalidation.codeplex.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">WinRT XAML Validation library</a> in conjunction with the code below to plug this gap.</p>\n<h1 id=\"quick-nod-to-idataerrorinfo\"><a href=\"#quick-nod-to-idataerrorinfo\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Quick nod to IDataErrorInfo</h1>\n<p>This interface used to be used for validation but was replaced by <code class=\"language-text\">INotifyDataErrorInfo</code>. The new interface provides a much nicer API which is easier to code against and better performance. If you are still using the old interface, its time to make the change.</p>\n<h1 id=\"conclusions\"><a href=\"#conclusions\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Conclusions</h1>\n<p>I've been tweaking this base class for the last few years and feel I've got a fairly good balance. I've not seen too many implementations of this interface, most blogs seem to cover <code class=\"language-text\">INotifyPropertyChanged</code> pretty well though. I'd be very interested if anyone has any comments or thoughts on improvements. Feel free to sound-off in the comments.</p>\n"}},{"node":{"title":"Model-View-ViewModel (MVVM) - Part 3 - INotifyPropertyChanged","path":"/model-view-viewmodel-mvvm-part3-inotifypropertychanged/","date":"18 June 2014","timeToRead":12,"description":"An base class implementation for the INotifyPropertyChanged interface. Used in the Model-View-ViewModel (MVVM) pattern. Targeted for best performance.","content":"<ul>\n<li><a href=\"/model-view-viewmodel-mvvm-part1-overview/\">Model-View-ViewModel (MVVM) - Part 1 - Overview</a></li>\n<li><a href=\"/model-view-viewmodel-mvvm-part2-idisposable/\">Model-View-ViewModel (MVVM) - Part 2 - IDisposable</a></li>\n<li><a href=\"/model-view-viewmodel-mvvm-part3-inotifypropertychanged/\">Model-View-ViewModel (MVVM) - Part 3 - INotifyPropertyChanged</a></li>\n<li><a href=\"/model-view-viewmodel-mvvm-part4-inotifydataerrorinfo/\">Model-View-ViewModel (MVVM) - Part 4 - INotifyDataErrorInfo</a></li>\n</ul>\n<p>I know there have been lots of Model-View-ViewModel (MVVM) articles talking about <a href=\"http://msdn.microsoft.com/en-GB/library/system.componentmodel.inotifypropertychanged.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">INotifyPropertyChanged</a>. I've read <strong>lots</strong> of them and this is the aggregation of all the knowledge I've learned plus some cool new stuff (I've not seen it done anywhere else but I could be wrong) which I've also covered in my <a href=\"/reactive-extensions-part1-replacing-events/\">Reactive Extensions (Rx) posts</a>.</p>\n<p>So what are the main aims of a base class implementing <a href=\"http://msdn.microsoft.com/en-GB/library/system.componentmodel.inotifypropertychanged.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">INotifyPropertyChanged</a>? Well, I think there are a few:</p>\n<ul>\n<li>Performance - Performance is king. It needs to be fast and I mean <strong>really</strong> fast. You can't afford for your UI to freeze up while your view works out all its bindings to the properties in your view model.</li>\n<li>Simplicity - I want to raise property changed events with one line of code and I don't want to mess around with strings if I can help it.</li>\n<li>Reactive Extensions (Rx) - Events are old school, I want an observable property changed event notification system instead of the <code class=\"language-text\">PropertyChanged</code> C# event.</li>\n<li>Human Error - I don't want to raise property change events for properties that don't exist by accident.</li>\n<li>Dependent Properties - Often, the value of one property depends on the value of another. I need to handle this somehow.</li>\n<li>Re-factoring - I don't want my code to break when I rename a property and forget to rename a string too.</li>\n<li>Has it Really Changed - I don't want to raise a property changed event if the value of a property has not really changed.</li>\n</ul>\n<p>So, without further ado, here is my implementation.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">namespace</span> Framework<span class=\"token punctuation\">.</span>ComponentModel\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>ComponentModel<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Diagnostics<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Reactive<span class=\"token punctuation\">.</span>Linq<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Reflection<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Runtime<span class=\"token punctuation\">.</span>CompilerServices<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Notifies subscribers that a property in this instance is changing or has changed.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NotifyPropertyChanges</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">Disposable</span><span class=\"token punctuation\">,</span> INotifyPropertyChanged <span class=\"token comment\">//, INotifyPropertyChanging</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Occurs when a property value changes.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token keyword\">event</span> <span class=\"token class-name\">PropertyChangedEventHandler</span> INotifyPropertyChanged<span class=\"token punctuation\">.</span>PropertyChanged\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">add</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>propertyChanged <span class=\"token operator\">+=</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">remove</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>propertyChanged <span class=\"token operator\">-=</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Occurs when a property value is changing.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">// event PropertyChangingEventHandler INotifyPropertyChanging.PropertyChanging</span>\n        <span class=\"token comment\">// {</span>\n        <span class=\"token comment\">//     add { this.PropertyChanging += value; }</span>\n        <span class=\"token comment\">//     remove { this.PropertyChanging -= value; }</span>\n        <span class=\"token comment\">// }</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Occurs when a property value changes.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">event</span> <span class=\"token class-name\">PropertyChangedEventHandler</span> propertyChanged<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Occurs when a property value is changing.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">// private event PropertyChangingEventHandler PropertyChanging;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Gets the when property changed observable event. Occurs when a property value changes.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;value></span>\n        <span class=\"token comment\">/// The when property changed observable event.</span>\n        <span class=\"token comment\">/// &lt;/value></span>\n        <span class=\"token keyword\">public</span> IObservable<span class=\"token operator\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token operator\">></span> WhenPropertyChanged\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">get</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">ThrowIfDisposed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">return</span> Observable\n                    <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">FromEventPattern</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">PropertyChangedEventHandler</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">PropertyChangedEventArgs</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>\n                        h <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>propertyChanged <span class=\"token operator\">+=</span> h<span class=\"token punctuation\">,</span>\n                        h <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>propertyChanged <span class=\"token operator\">-=</span> h<span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">Select</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">=></span> x<span class=\"token punctuation\">.</span>EventArgs<span class=\"token punctuation\">.</span>PropertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Gets the when property changing observable event. Occurs when a property value is changing.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;value></span>\n        <span class=\"token comment\">/// The when property changing observable event.</span>\n        <span class=\"token comment\">/// &lt;/value></span>\n        <span class=\"token comment\">// public IObservable&lt;EventPattern&lt;PropertyChangingEventArgs>> WhenPropertyChanging</span>\n        <span class=\"token comment\">// {</span>\n        <span class=\"token comment\">//     get</span>\n        <span class=\"token comment\">//     {</span>\n        <span class=\"token comment\">//         return Observable</span>\n        <span class=\"token comment\">//             .FromEventPattern&lt;PropertyChangingEventHandler, PropertyChangingEventArgs>(</span>\n        <span class=\"token comment\">//                 h => this.PropertyChanging += h,</span>\n        <span class=\"token comment\">//                 h => this.PropertyChanging -= h)</span>\n        <span class=\"token comment\">//             .AsObservable();</span>\n        <span class=\"token comment\">//     }</span>\n        <span class=\"token comment\">// }</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Raises the PropertyChanged event.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyName\">Name of the property.&lt;/param></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">OnPropertyChanged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">CallerMemberName</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">string</span> propertyName <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Assert</span><span class=\"token punctuation\">(</span>\n                <span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n                <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetRuntimeProperty</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"Check that the property name exists for this instance.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">PropertyChangedEventHandler</span> eventHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>propertyChanged<span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>eventHandler <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">eventHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PropertyChangedEventArgs</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Raises the PropertyChanged event.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyNames\">The property names.&lt;/param></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">OnPropertyChanged</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">params</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> propertyNames<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>propertyNames <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArgumentNullException</span><span class=\"token punctuation\">(</span><span class=\"token function\">nameof</span><span class=\"token punctuation\">(</span>propertyNames<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> propertyName <span class=\"token keyword\">in</span> propertyNames<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnPropertyChanged</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Raises the PropertyChanging event.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyName\">Name of the property.&lt;/param></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">OnPropertyChanging</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">CallerMemberName</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">string</span> propertyName <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Assert</span><span class=\"token punctuation\">(</span>\n                <span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n                <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetRuntimeProperty</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"Check that the property name exists for this instance.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// PropertyChangingEventHandler eventHandler = this.PropertyChanging;</span>\n\n            <span class=\"token comment\">// if (eventHandler != null)</span>\n            <span class=\"token comment\">// {</span>\n            <span class=\"token comment\">//     eventHandler(this, new PropertyChangingEventArgs(propertyName));</span>\n            <span class=\"token comment\">// }</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Raises the PropertyChanging event.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyNames\">The property names.&lt;/param></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">OnPropertyChanging</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">params</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> propertyNames<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>propertyNames <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArgumentNullException</span><span class=\"token punctuation\">(</span><span class=\"token function\">nameof</span><span class=\"token punctuation\">(</span>propertyNames<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> propertyName <span class=\"token keyword\">in</span> propertyNames<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnPropertyChanging</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Sets the value of the property to the specified value if it has changed.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;typeparam name=\"TProp\">The type of the property.&lt;/typeparam></span>\n        <span class=\"token comment\">/// &lt;param name=\"currentValue\">The current value of the property.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"newValue\">The new value of the property.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyName\">Name of the property.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;returns>&lt;c>true&lt;/c> if the property was changed, otherwise &lt;c>false&lt;/c>.&lt;/returns></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">bool</span> <span class=\"token generic-method\"><span class=\"token function\">SetProperty</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TProp</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">ref</span> <span class=\"token class-name\">TProp</span> currentValue<span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">TProp</span> newValue<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span><span class=\"token class-name\">CallerMemberName</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">string</span> propertyName <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">ThrowIfDisposed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">object</span><span class=\"token punctuation\">.</span><span class=\"token function\">Equals</span><span class=\"token punctuation\">(</span>currentValue<span class=\"token punctuation\">,</span> newValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnPropertyChanging</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                currentValue <span class=\"token operator\">=</span> newValue<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnPropertyChanged</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">return</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Sets the value of the property to the specified value if it has changed.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;typeparam name=\"TProp\">The type of the property.&lt;/typeparam></span>\n        <span class=\"token comment\">/// &lt;param name=\"currentValue\">The current value of the property.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"newValue\">The new value of the property.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyNames\">The names of all properties changed.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;returns>&lt;c>true&lt;/c> if the property was changed, otherwise &lt;c>false&lt;/c>.&lt;/returns></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">bool</span> <span class=\"token generic-method\"><span class=\"token function\">SetProperty</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TProp</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">ref</span> <span class=\"token class-name\">TProp</span> currentValue<span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">TProp</span> newValue<span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">params</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> propertyNames<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">ThrowIfDisposed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">object</span><span class=\"token punctuation\">.</span><span class=\"token function\">Equals</span><span class=\"token punctuation\">(</span>currentValue<span class=\"token punctuation\">,</span> newValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnPropertyChanging</span><span class=\"token punctuation\">(</span>propertyNames<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                currentValue <span class=\"token operator\">=</span> newValue<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnPropertyChanged</span><span class=\"token punctuation\">(</span>propertyNames<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">return</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Sets the value of the property to the specified value if it has changed.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"equal\">A function which returns &lt;c>true&lt;/c> if the property value has changed, otherwise &lt;c>false&lt;/c>.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"action\">The action where the property is set.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyName\">Name of the property.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;returns>&lt;c>true&lt;/c> if the property was changed, otherwise &lt;c>false&lt;/c>.&lt;/returns></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">bool</span> <span class=\"token function\">SetProperty</span><span class=\"token punctuation\">(</span>\n            Func<span class=\"token operator\">&lt;</span><span class=\"token keyword\">bool</span><span class=\"token operator\">></span> equal<span class=\"token punctuation\">,</span> \n            <span class=\"token class-name\">Action</span> action<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span><span class=\"token class-name\">CallerMemberName</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">string</span> propertyName <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">ThrowIfDisposed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnPropertyChanging</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnPropertyChanged</span><span class=\"token punctuation\">(</span>propertyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Sets the value of the property to the specified value if it has changed.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"equal\">A function which returns &lt;c>true&lt;/c> if the property value has changed, otherwise &lt;c>false&lt;/c>.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"action\">The action where the property is set.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;param name=\"propertyNames\">The property names.&lt;/param></span>\n        <span class=\"token comment\">/// &lt;returns>&lt;c>true&lt;/c> if the property was changed, otherwise &lt;c>false&lt;/c>.&lt;/returns></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">bool</span> <span class=\"token function\">SetProperty</span><span class=\"token punctuation\">(</span>\n            Func<span class=\"token operator\">&lt;</span><span class=\"token keyword\">bool</span><span class=\"token operator\">></span> equal<span class=\"token punctuation\">,</span> \n            <span class=\"token class-name\">Action</span> action<span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">params</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> propertyNames<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">ThrowIfDisposed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnPropertyChanging</span><span class=\"token punctuation\">(</span>propertyNames<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnPropertyChanged</span><span class=\"token punctuation\">(</span>propertyNames<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1 id=\"simple-example\"><a href=\"#simple-example\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Simple Example</h1>\n<p>An example of how you can use this base class is as follows.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CatCountViewModel</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">NotifyPropertyChanges</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> numberOfCats<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> NumberOfCats\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">get</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>numberOfCats<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">set</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">SetProperty</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">ref</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>numberOfCats<span class=\"token punctuation\">,</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1 id=\"performance\"><a href=\"#performance\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Performance</h1>\n<p>As I said before, performance is king. A slow application is a frustrating application. However, there has always been a problem. When you want to raise a property changed event, you have to pass in a string. We can't check the validity of the string at compile time, only at runtime. So we can get errors due to typos etc. which can get overlooked.</p>\n<p>There are a lot of implementations of <a href=\"http://msdn.microsoft.com/en-GB/library/system.componentmodel.inotifypropertychanged.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">INotifyPropertyChanged</a> that use reflection or expression trees and as <a href=\"http://blog.quantumbitdesigns.com/2010/01/26/mvvm-lambda-vs-inotifypropertychanged-vs-dependencyobject\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this</a> and <a href=\"http://blog.amusedia.com/2013/06/inotifypropertychanged-implementation.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this</a> blog show, using reflection is a terribly slow method of raising an event and to be avoided.</p>\n<p>Luckily, Microsoft introduced the <a href=\"http://msdn.microsoft.com/en-gb/library/system.runtime.compilerservices.callermembernameattribute.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CallerMemberNameAttribute</a> attribute, which means that as in the above example, we don't need to add a string for the property name, it gets added for us to the last optional parameter in the <code class=\"language-text\">SetProperty</code> method.</p>\n<p>The <code class=\"language-text\">SetProperty</code> method uses the <a href=\"http://msdn.microsoft.com/en-us/library/14akc2c7.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ref keyword</a> to pass the parameter by reference (Passing parameters by reference is faster). It then checks to see if the <code class=\"language-text\">numberOfCats</code> parameter is different from the <code class=\"language-text\">value</code> parameter (There is no point raising a property changed event if they are the same). Only then, do we raise a property changed event.</p>\n<h1 id=\"handling-dependent-properties\"><a href=\"#handling-dependent-properties\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Handling Dependent Properties</h1>\n<p>But what about dependent properties. Where one property affects the value of another. Well, lets take a look at another example.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CatCounter</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">NotifyPropertyChanges</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> numberOfCats<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> NumberOfCats\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">get</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>numberOfCats<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">set</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">SetProperty</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">ref</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>numberOfCats<span class=\"token punctuation\">,</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"NumberOfCats\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"NumberOfCatsDescription\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">string</span> NumberOfCatsDescription <span class=\"token operator\">=></span> $<span class=\"token string\">\"{this.NumberOfCats} Cats Counted\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You can see, that I've not done anything spectacular and just passed in the strings. As I'm using the <a href=\"http://msdn.microsoft.com/en-us/library/w5zay9db.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">params</a> keyword, you can pass in as many strings as you want and the <code class=\"language-text\">SetProperty</code> method will raise a property changed event for each one.</p>\n<p>If you give me a moment, I will explain why I think this is the right compromise to make. Lets make no mistake, you do need to compromise between performance and simplicity/maintainability. There are approaches which make this eventuality simpler and easier to understand but they can and will degrade performance.</p>\n<p>So does using strings cause problems? First of all, if you use a Visual Studio Add-in like Resharper, this problem is <a href=\"http://blog.jetbrains.com/dotnet/2012/07/24/inotifypropertychanged-support-in-resharper-7\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">solved</a> as it checks that the strings match the property name for you. Secondly, as a backup the <code class=\"language-text\">OnPropertyChanged</code> method in the implementation above contains some <code class=\"language-text\">Debug.Assert</code> statements (These are removed in Release mode and have no effect on performance) to check that the property names exist and are correct, if they are not you get a error message. Thirdly, this is fairly rare in my experience and I can deal with the overhead of having a couple of extra strings.</p>\n<p>Again, this is a choice I've made to go with performance over maintainability.</p>\n<h1 id=\"dealing-with-wrapped-objects\"><a href=\"#dealing-with-wrapped-objects\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Dealing with Wrapped Objects</h1>\n<p>What if you want to wrap an object that looks like the one below with a class that supports <a href=\"http://msdn.microsoft.com/en-GB/library/system.componentmodel.inotifypropertychanged.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">INotifyPropertyChanged</a>? This is a scenario I have not seen many people cover but occurs fairly often in my experience.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CatCount</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> Count <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>An example view model for the CatCount class can be found below.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CatCountModel</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">NotifyPropertyChanges</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">CatCount</span> catCount<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> NumberOfCats\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">get</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>catCount<span class=\"token punctuation\">.</span>Count<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">SetProperty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>catCount<span class=\"token punctuation\">.</span>Count <span class=\"token operator\">==</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>catCount<span class=\"token punctuation\">.</span>Count <span class=\"token operator\">=</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>So here we are providing the <code class=\"language-text\">SetProperty</code> method with two delegates. We can't use the ref keyword we used earlier because this gives us the compiler error \"A property, indexer or dynamic member access may not be passed as an out or ref parameter\". So we use delegates as an alternative which is not as fast as the ref keyword but almost as fast.</p>\n<p>The first delegate determines if the cat count has actually changed. Only if it has (Remember, executing a delegate is far cheaper than updating the UI), do we call the next delegate which actually sets the value. Finally the <code class=\"language-text\">SetProperty</code> method raises a property changed event.</p>\n<h1 id=\"using-reactive-extensions-rx-to-replace-the-propertychanged-event\"><a href=\"#using-reactive-extensions-rx-to-replace-the-propertychanged-event\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Using Reactive Extensions (Rx) to Replace the PropertyChanged Event</h1>\n<p>C# events are old school. Reactive Extensions (Rx) provides a cleaner and far more powerful drop-in replacement for C# events. I'm not going to go over the advantages of Reactive Extensions here but you can take a look at a series of blog posts I've done in the <a href=\"/reactive-extensions-part1-replacing-events/\">past</a>.</p>\n<p>We can hide the <code class=\"language-text\">PropertyChanged</code> C# event by explicitly implementing the interface (Click <a href=\"http://stackoverflow.com/questions/143405/c-sharp-interfaces-implicit-implementation-versus-explicit-implementation\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a> for details on implicit versus explicit implementations of interfaces).</p>\n<p>The <code class=\"language-text\">PropertyChanged</code> C# event can still be accessed by first casting the object to <a href=\"http://msdn.microsoft.com/en-GB/library/system.componentmodel.inotifypropertychanged.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">INotifyPropertyChanged</a>. Binding in XAML languages, which uses this interface continues to work. Our new Reactive Extensions (Rx) observable event called <code class=\"language-text\">WhenPropertyChanged</code> of type <code class=\"language-text\">IObservable&lt;string&gt;</code> (The string is the property name) is now the default method of subscribing for property changed events and we've hidden away the old C# event.</p>\n<h1 id=\"implementing-inotifypropertychanging\"><a href=\"#implementing-inotifypropertychanging\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Implementing INotifyPropertyChanging</h1>\n<p>Take another look at the title of this paragraph, it says <a href=\"http://msdn.microsoft.com/en-us/library/system.componentmodel.inotifypropertychanging%28v=vs.110%29.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">INotifyPropertyChang<strong>ing</strong></a> and not <a href=\"http://msdn.microsoft.com/en-GB/library/system.componentmodel.inotifypropertychanged.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">INotifyPropertyChang<strong>ed</strong></a>.</p>\n<p>This interface has a single event called <code class=\"language-text\">PropertyChang**ing**</code> and is raised <strong>before</strong> a property is about to be changed. This interface is not actually used by any XAML framework but does complement the <code class=\"language-text\">INotifyPropertyChanged</code> interface and can be useful in your view models when you want to know that a property is about to change and do something about it.</p>\n<p>Given that we've written a base class, it is super easy to include it too. You should note that this interface only exists in the full .NET Framework and Silverlight. It does not exist on Windows Store or Windows Phone platforms.</p>\n<p>As we are writing a base class for a Portable Class Library (PCL), I've commented it out. However, if I were to create a full .NET or Silverlight class library, I would definitely put that code back in.</p>\n<p>If you find the interface useful and you too are using a Portable Class Library (PCL), you could take a copy of the <code class=\"language-text\">INotifyPropertyChanging</code> interface and include it with your base class. If Microsoft ever decide to include it into the PCL, you simply need to remove your class and use the one in the framework.</p>\n<h1 id=\"conclusions\"><a href=\"#conclusions\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Conclusions</h1>\n<p>I've gone through many iterations to get to this base class. As I've shown, I've had very particular goals in mind. Your mileage may vary but I believe with the tools Microsoft have given us, this is a good compromise and covers all the scenarios I can think of. I'd be very interested if anyone has any comments or thoughts on improvements. Feel free to sound-off in the comments.</p>\n"}},{"node":{"title":"Model-View-ViewModel (MVVM) - Part 2 - IDisposable","path":"/model-view-viewmodel-mvvm-part2-idisposable/","date":"13 June 2014","timeToRead":4,"description":"Implementing IDisposable correctly is ridiculously hard. A Disposable base class can make it easier. Using IDisposable in Model-View-ViewModel (MVVM) really helps.","content":"<ul>\n<li><a href=\"/model-view-viewmodel-mvvm-part1-overview/\">Model-View-ViewModel (MVVM) - Part 1 - Overview</a></li>\n<li><a href=\"/model-view-viewmodel-mvvm-part2-idisposable/\">Model-View-ViewModel (MVVM) - Part 2 - IDisposable</a></li>\n<li><a href=\"/model-view-viewmodel-mvvm-part3-inotifypropertychanged/\">Model-View-ViewModel (MVVM) - Part 3 - INotifyPropertyChanged</a></li>\n<li><a href=\"/model-view-viewmodel-mvvm-part4-inotifydataerrorinfo/\">Model-View-ViewModel (MVVM) - Part 4 - INotifyDataErrorInfo</a></li>\n</ul>\n<p>View models these days interact with all kinds of precious resources like Compasses and the GPS. Implementing <code class=\"language-text\">IDisposable</code> is an important pattern you can follow to dispose of these resources cleanly. Freeing them up to be used elsewhere and saving the users battery (Particularly important on mobile devices). Using the <code class=\"language-text\">IDisposable</code> interface in the Model-View-ViewModel (MVVM) pattern is a wise decision.</p>\n<p>Implementing <code class=\"language-text\">IDisposable</code> <strong>correctly</strong> is ridiculously hard. If you don't know how hard it really is, I recommend reading the top comment on <a href=\"http://stackoverflow.com/questions/538060/proper-use-of-the-idisposable-interface\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this</a> Stack Overflow article.</p>\n<p>Implementing <a href=\"http://msdn.microsoft.com/en-GB/library/system.idisposable.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">IDisposable</a> is one of the rare times in C# where a developer has to use <a href=\"http://msdn.microsoft.com/en-us/library/66x5fx1b.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">C# Destructors</a> and also one of the few times when we have to tickle the garbage collector to stop it from trying to release the unmanaged resources twice by calling <a href=\"http://msdn.microsoft.com/en-us/library/system.gc.suppressfinalize%28v=vs.110%29.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SuppressFinalize</a> on <a href=\"http://msdn.microsoft.com/en-us/library/system.gc%28v=vs.110%29.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GC</a>.</p>\n<p>Having to write this code repeatedly is difficult and error prone, so how about a base class?</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">namespace</span> Framework<span class=\"token punctuation\">.</span>ComponentModel\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Reactive<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Reactive<span class=\"token punctuation\">.</span>Linq<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">using</span> System<span class=\"token punctuation\">.</span>Reactive<span class=\"token punctuation\">.</span>Subjects<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Base class for members implementing &lt;see cref=\"IDisposable\"/>.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Disposable</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">IDisposable</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">bool</span> isDisposed<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">private</span> Subject<span class=\"token operator\">&lt;</span>Unit<span class=\"token operator\">></span> whenDisposedSubject<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Finalizes an instance of the &lt;see cref=\"Disposable\"/> class. Releases unmanaged</span>\n        <span class=\"token comment\">/// resources and performs other cleanup operations before the &lt;see cref=\"Disposable\"/></span>\n        <span class=\"token comment\">/// is reclaimed by garbage collection. Will run only if the</span>\n        <span class=\"token comment\">/// Dispose method does not get called.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token operator\">~</span><span class=\"token function\">Disposable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">Dispose</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Gets the when errors changed observable event. Occurs when the validation errors have changed for a property or for the entire object.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;value></span>\n        <span class=\"token comment\">/// The when errors changed observable event.</span>\n        <span class=\"token comment\">/// &lt;/value></span>\n        <span class=\"token keyword\">public</span> IObservable<span class=\"token operator\">&lt;</span>Unit<span class=\"token operator\">></span> WhenDisposed\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">get</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>IsDisposed<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">return</span> Observable<span class=\"token punctuation\">.</span><span class=\"token function\">Return</span><span class=\"token punctuation\">(</span>Unit<span class=\"token punctuation\">.</span>Default<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword\">else</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>whenDisposedSubject <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>whenDisposedSubject <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token generic-method\"><span class=\"token function\">Subject</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Unit</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n\n                    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>whenDisposedSubject<span class=\"token punctuation\">.</span><span class=\"token function\">AsObservable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Gets a value indicating whether this &lt;see cref=\"Disposable\"/> is disposed.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;value>&lt;c>true&lt;/c> if disposed; otherwise, &lt;c>false&lt;/c>.&lt;/value></span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">bool</span> IsDisposed <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isDisposed<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Performs application-defined tasks associated with freeing, releasing, or resetting unmanaged resources.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">Dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Dispose all managed and unmanaged resources.</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">Dispose</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Take this object off the finalization queue and prevent finalization code for this</span>\n            <span class=\"token comment\">// object from executing a second time.</span>\n            GC<span class=\"token punctuation\">.</span><span class=\"token function\">SuppressFinalize</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Disposes the managed resources implementing &lt;see cref=\"IDisposable\"/>.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">DisposeManaged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Disposes the unmanaged resources implementing &lt;see cref=\"IDisposable\"/>.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">DisposeUnmanaged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Throws a &lt;see cref=\"ObjectDisposedException\"/> if this instance is disposed.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">ThrowIfDisposed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isDisposed<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectDisposedException</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &lt;summary></span>\n        <span class=\"token comment\">/// Releases unmanaged and - optionally - managed resources.</span>\n        <span class=\"token comment\">/// &lt;/summary></span>\n        <span class=\"token comment\">/// &lt;param name=\"disposing\">&lt;c>true&lt;/c> to release both managed and unmanaged resources;</span>\n        <span class=\"token comment\">/// &lt;c>false&lt;/c> to release only unmanaged resources, called from the finalizer only.&lt;/param></span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">Dispose</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">bool</span> disposing<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Check to see if Dispose has already been called.</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isDisposed<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// If disposing managed and unmanaged resources.</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>disposing<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">DisposeManaged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">DisposeUnmanaged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isDisposed <span class=\"token operator\">=</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>whenDisposedSubject <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token comment\">// Raise the WhenDisposed event.</span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>whenDisposedSubject<span class=\"token punctuation\">.</span><span class=\"token function\">OnNext</span><span class=\"token punctuation\">(</span>Unit<span class=\"token punctuation\">.</span>Default<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>whenDisposedSubject<span class=\"token punctuation\">.</span><span class=\"token function\">OnCompleted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>whenDisposedSubject<span class=\"token punctuation\">.</span><span class=\"token function\">Dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>There are several interesting facets to this implementation.</p>\n<ol>\n<li>There is a difference between disposing of managed and unmanaged resources in the disposable pattern. To facilitate this, there are two separate protected methods which can be overridden in a derived class to dispose of each of them.</li>\n<li>The disposable pattern requires you to throw an <code class=\"language-text\">ObjectDisposedException</code> when you try to access a property or method after the object has been disposed. To achieve this, there is a <code class=\"language-text\">ThrowIfDisposed</code> helper method which can be added to the top of each property or method.</li>\n<li>There is an <code class=\"language-text\">IsDisposed</code> property which can be useful if we don't know if the object is disposed or not.</li>\n<li>Finally, there is a Reactive Extensions (Rx) observable <code class=\"language-text\">WhenDisposed</code> property. This allows us to register for the dispose event.</li>\n</ol>\n<p>Here is an example of how the base class is used to dispose of both a managed and unmanaged (COM object) resources.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DisposableExample</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">Disposable</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ManagedResource</span> managedResource<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UnmanagedResource</span> unmanagedResource<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">Foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">ThrowIfDisposed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Do Stuff</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">void</span> <span class=\"token function\">DisposeManaged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>managedResource<span class=\"token punctuation\">.</span><span class=\"token function\">Dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">void</span> <span class=\"token function\">DisposeUnmanaged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        Marshal<span class=\"token punctuation\">.</span><span class=\"token function\">ReleaseComObject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>unmanagedResource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>unmanagedResource <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>An example of how to dispose of an instance of the above object.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token class-name\">DisposableExample</span> disposable <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DisposableExample</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndisposable<span class=\"token punctuation\">.</span>WhenDisposed<span class=\"token punctuation\">.</span><span class=\"token function\">Subscribe</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">=></span> Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Disposed Event Fired\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndisposable<span class=\"token punctuation\">.</span><span class=\"token function\">Dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nConsole<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span>disposable<span class=\"token punctuation\">.</span>IsDisposed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>As you can see, it looks a whole lot simpler and has some pretty cool helper functions and features. No more need to remember how to implement this complicated pattern.</p>\n"}},{"node":{"title":"Model-View-ViewModel (MVVM) - Part 1 - Overview","path":"/model-view-viewmodel-mvvm-part1-overview/","date":"14 May 2014","timeToRead":5,"description":"What really goes into using Model-View-ViewModel (MVVM) in .NET. Base classes for INotifyPropertyChanged, INotifyDataErrorInfo, IDisposable and a lot more.","content":"<ul>\n<li><a href=\"/model-view-viewmodel-mvvm-part1-overview/\">Model-View-ViewModel (MVVM) - Part 1 - Overview</a></li>\n<li><a href=\"/model-view-viewmodel-mvvm-part2-idisposable/\">Model-View-ViewModel (MVVM) - Part 2 - IDisposable</a></li>\n<li><a href=\"/model-view-viewmodel-mvvm-part3-inotifypropertychanged/\">Model-View-ViewModel (MVVM) - Part 3 - INotifyPropertyChanged</a></li>\n<li><a href=\"/model-view-viewmodel-mvvm-part4-inotifydataerrorinfo/\">Model-View-ViewModel (MVVM) - Part 4 - INotifyDataErrorInfo</a></li>\n</ul>\n<p>I've been meaning for some time to do a series of posts about Model-View-ViewModel (MVVM) and its potential base classes. Then I read <a href=\"http://mtaulty.com/CommunityServer/blogs/mike_taultys_blog/archive/2014/05/09/windows-phone-8-1-and-xaml-apps-making-it-easier-for-mvvm-developers.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Mike Taulty's post</a> about why MVVM 'bits' not built in to .NET.</p>\n<p>My aim in these posts will be to either, pick off the shelf components which are best of breed where there is no point reinventing the wheel or build my own components where necessary.</p>\n<p>Assuming you already know about the basic Model-View-ViewModel (MVVM) pattern described in the title image of this post, when we talk about MVVM, what do we really mean?</p>\n<h1 id=\"platforms\"><a href=\"#platforms\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Platforms</h1>\n<p>Well there are several .NET platforms that all provide some basic low level support for Model-View-ViewModel (MVVM), Windows Store, Windows Phone, Silverlight and Windows Presentation Foundation (WPF). It is all of these platforms that I'll be discussing and targeting my code towards.</p>\n<h1 id=\"mvvm-bits\"><a href=\"#mvvm-bits\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>MVVM 'Bits'</h1>\n<p>In Mike Taulty's post, he goes through a list of 'bits' which all come together to help with building an application that fits into the MVVM design pattern. I've added to that list below:</p>\n<ol>\n<li><code class=\"language-text\">IDisposable</code> - When you have a scarce resource like a GPS, gyroscope or compass, you inevitably need to dispose of it somewhere. Implementing <code class=\"language-text\">IDisposable</code> <strong>properly</strong> is <a href=\"http://msdn.microsoft.com/en-us/library/system.idisposable%28v=vs.110%29.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">hard work</a>. A base class would be handy.</li>\n<li><code class=\"language-text\">INotifyPropertyChanged</code> - This is the building block of all .NET based MVVM. There needs to be a base class for this that is high performance and yet simple and easy to use.</li>\n<li><code class=\"language-text\">INotifyDataErrorInfo</code> - Validation is an often overlooked part of an application. This handy interface makes doing validation of your view models a cinch.</li>\n<li><code class=\"language-text\">IEditableObject</code> (WPF only) - This interface helps with implementing undo and redo but is used specifically in the WPF data grid.</li>\n<li><code class=\"language-text\">ObservableCollection&lt;T&gt;</code> - This collection is a good start out of the box but why does it still not have an AddRange method? Why do we not have an <code class=\"language-text\">ObservableDictionary&lt;TKey, TValue&gt;</code> or a <code class=\"language-text\">KeyedObservableCollection&lt;TKey, TValue&gt;</code>? What if you have a collection of items implementing <code class=\"language-text\">INotifyPropertyChanged</code> and you want to know if one of those items changes, why can't the collection type help you there also?</li>\n<li><code class=\"language-text\">ICommand</code> - Most implementations out there provide a base class for <code class=\"language-text\">ICommand</code> and usually call it <code class=\"language-text\">RelayCommand</code> or <code class=\"language-text\">DelegateCommand</code>. They usually have another implementation with a generic argument <code class=\"language-text\">RelayCommand&lt;T&gt;</code> or <code class=\"language-text\">DelegateCommand&lt;T&gt;</code>. These are a quick way to add a command to your view model, where the implementation of the command is usually a method in your view model passed in as a delegate. Sometimes though, this is not enough. What if you have a largish command and want to split it off into a separate class, a base class for <code class=\"language-text\">ICommand</code> would be useful. What if you have a command that does <code class=\"language-text\">async</code> and <code class=\"language-text\">await</code>? <code class=\"language-text\">ICommand</code> doesn't support that but can we provide some help here?</li>\n<li>Inversion of control (IoC) - There are a lot of IoC frameworks out there already, why reinvent the wheel. Just pick one but which one?</li>\n</ol>\n<p>I'll pause just here as I think the above listed items are all base classes that could be used across the board on all the major platforms. They are at the very heart of MVVM in .NET. The rest of the list below are more dependant on the type of application you are building.</p>\n<ol>\n<li>Navigation - This has always been a stone in my shoe. Navigation is inherently something that happens in the view but it is something that view models often need to understand. The problem is, that the view model is not supposed to know about the view at all. This problem occurs again and again in different forms on each platform.</li>\n</ol>\n<blockquote>\n<ul>\n<li>Navigating pages in Windows Store, Windows Phone, Silverlight.</li>\n<li>Navigating Windows in Windows Presentation Foundation (WPF) and Windows Store.</li>\n</ul>\n</blockquote>\n<ol>\n<li>User Interaction - I'm talking about <code class=\"language-text\">MessageBox</code>'s, <code class=\"language-text\">MessageDialog</code>'s, Toast's etc. Giving the user information or asking them questions happens on all platforms. This problem is very similar to the Navigation problem.</li>\n<li>Connecting your Views to ViewModels - This is usually some by-product of which IoC container you choose to use, whether it's MEF, Unity, Autofac or some other. There is no recommended way of doing this and I don't think I've ever found a 'correct' way of doing this.</li>\n<li>Saving View Model state - This usually needs to be done when the application closes or suspends due to some user interaction. A lot of frameworks simply serialize the whole View Model and save it away but is that the best way and what about doing that in a WPF application?</li>\n<li>Events - Passing events between view models is a fairly useful ability, allowing communication and passing of state.</li>\n<li>Composing Views - Some MVVM frameworks like PRISM provide support for composing different views together. Alternatively, this process usually has a connection with the type of IoC container you are using.</li>\n<li>Firing Commands - A lot of controls can't fire off <code class=\"language-text\">ICommand</code>'s in XAML because they don't provide a Command property or sometimes you want to fire a command based on some event or even a key press.</li>\n<li>Other Stuff - Reactive Extensions can help in some pretty interesting ways with MVVM. What about Portable Class Library's? Why does the MVVM on one platform need to be different from another?</li>\n</ol>\n<p>The last two things in the list are more abstract requirements for any MVVM framework.</p>\n<ol>\n<li>Testability - Writing a view model which is easy to test is hard work. Especially if you want to use <code class=\"language-text\">MessageBox</code>'s, GPS API's or other API's which make testing difficult. You don't want a <code class=\"language-text\">MessageBox</code> popping up in the middle of your test do you?</li>\n<li>Performance - Your application needs to run fast, especially if it's running on a phone. For example, a lot of MVVM frameworks use expression trees and reflection to raise property changed notifications . What impact does this have in the performance versus maintainability trade off?</li>\n</ol>\n<h1 id=\"existing-frameworks\"><a href=\"#existing-frameworks\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Existing Frameworks</h1>\n<p>Wow, that's a lot of stuff! All of this 'stuff' is related but covers a huge range of subjects. A lot of existing MVVM frameworks try to do all of this at once!</p>\n<p>In my humble opinion, because they do so much, they usually only cover some, say 70-80% of the full functionality. What business does an MVVM framework have including an IoC framework? There are lots of IoC frameworks out there that are far more powerful than anything we could write but a lot of MVVM frameworks include one too.</p>\n<h1 id=\"conclusions\"><a href=\"#conclusions\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Conclusions</h1>\n<p>So ideally what we need is something modular, that you can plug bits into but also something that covers all the bases.</p>\n<p>Whats your opinion? I've looked at a lot of frameworks MVVM Light, PRISM, etc. In my opinion, the seven top items are the most important but also the most neglected bits of MVVM. Is there some framework out there that does all this and more?</p>\n<p>I'll discuss this and a lot more in the coming posts.</p>\n"}},{"node":{"title":"GetHashCode Made Easy","path":"/gethashcode-made-easy/","date":"14 April 2014","timeToRead":9,"description":"Implementing GetHashCode is hard work and little understood. Learn how to implement GetHashCode as quickly and as simply as possible.","content":"<div class=\"custom-block tip\"><p class=\"custom-block-title\">Update (2019-06-12)</p><p>I updated my HashCode implementation to cover a few more scenarios which I discuss below.</p></div>\n<div class=\"custom-block tip\"><p class=\"custom-block-title\">Update (2018-08-14)</p><p>I updated this article to talk about a new <code class=\"language-text\">HashCode</code> class included in .NET Core 2.1 and licensing information for my code since I've been asked repeatedly.</p></div>\n<p>Implementing <code class=\"language-text\">GetHashCode</code> is hard work and little understood. If you take a look on MSDN or StackOverflow for a few pointers, you'll see a plethora of examples with all kinds of little used C# operators and magic numbers with little explanation for developers (Especially the newbies) what they are for and why we need them. This, for a method which exists on the <code class=\"language-text\">Object</code> class and is the root of all that is good and wholesome in C# is surprising.</p>\n<p>Before I continue, I recommend reading <a href=\"http://blogs.msdn.com/b/ericlippert/archive/2011/02/28/guidelines-and-rules-for-gethashcode.aspx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Eric Lippert's blog post</a> about the subject. He does not show any code, just goes into when and where we need to implement the <code class=\"language-text\">GetHashCode</code> method. Eric does a much better job than I could do but in short, <code class=\"language-text\">GetHashCode</code> is implemented wherever you implement the <code class=\"language-text\">Equals</code> method and ideally your class should be immutable.</p>\n<p>Now down to the nitty gritty. How do we make implementing <code class=\"language-text\">GetHashCode</code> easy. Well, suppose we have the following class:</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">sealed</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SuperHero</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> <span class=\"token keyword\">string</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> ReadOnlyCollection<span class=\"token operator\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token operator\">></span> powers<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">SuperHero</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> name<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">,</span> IEnumerable<span class=\"token operator\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token operator\">></span> powers<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> age<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>powers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token generic-method\"><span class=\"token function\">ReadOnlyCollection</span><span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>powers<span class=\"token punctuation\">.</span><span class=\"token function\">ToList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> Age <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">string</span> Name <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> ReadOnlyCollection<span class=\"token operator\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token operator\">></span> Powers <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>powers<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">bool</span> <span class=\"token function\">Equals</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">object</span> obj<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span> \n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">int</span> <span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// TODO</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In our example we have an immutable object with a variety of fields of different types, including a collection. One possible implementation of <code class=\"language-text\">GetHashCode</code> according to the highest rated <a href=\"http://stackoverflow.com/questions/263400/what-is-the-best-algorithm-for-an-overridden-system-object-gethashcode/263416#263416\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">StackOverflow post</a> (If modified to fit our example and deal with nulls) may be:</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">int</span> <span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">unchecked</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">int</span> hashCode <span class=\"token operator\">=</span> <span class=\"token number\">17</span><span class=\"token punctuation\">;</span>\n\n        hashCode <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>hashCode <span class=\"token operator\">*</span> <span class=\"token number\">23</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>name <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">?</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        hashCode <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>hashCode <span class=\"token operator\">*</span> <span class=\"token number\">23</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span> power <span class=\"token keyword\">in</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>powers<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            hashCode <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>hashCode <span class=\"token operator\">*</span> <span class=\"token number\">23</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>power <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">?</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">:</span> power<span class=\"token punctuation\">.</span><span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> hashCode<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I don't know about you but that code looks awfully unwieldy to me. For a start we've got two different magic numbers 17 and 23. Why? As it happens these are prime numbers and reduces the chance of getting collisions between hashes (Two un-equal objects are supposed to have different hash codes but sometimes this is not the case due to hash collisions that can occur).</p>\n<p>We've also got the <code class=\"language-text\">unchecked</code> C# keyword which stops overflow checking to improve performance (That's not something you see every day). Bear in mind that the whole point of the <code class=\"language-text\">GetHashCode</code> method is to allow things like the <code class=\"language-text\">Dictionary</code> type to <strong>quickly</strong> retrieve objects.</p>\n<p>I personally would not be able to remember how to do this each time I need to implement <code class=\"language-text\">GetHashCode</code> and it seems like you could very easily introduce bugs by making a typo. How about a helper class (Well actually a <code class=\"language-text\">struct</code> for better performance)?</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token comment\">/// &lt;summary></span>\n<span class=\"token comment\">/// A hash code used to help with implementing &lt;see cref=\"object.GetHashCode()\"/>.</span>\n<span class=\"token comment\">/// &lt;/summary></span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">struct</span> HashCode <span class=\"token punctuation\">:</span> IEquatable<span class=\"token operator\">&lt;</span>HashCode<span class=\"token operator\">></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> EmptyCollectionPrimeNumber <span class=\"token operator\">=</span> <span class=\"token number\">19</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> <span class=\"token keyword\">int</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Initializes a new instance of the &lt;see cref=\"HashCode\"/> struct.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token comment\">/// &lt;param name=\"value\">The value.&lt;/param></span>\n    <span class=\"token keyword\">private</span> <span class=\"token function\">HashCode</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">value</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Performs an implicit conversion from &lt;see cref=\"HashCode\"/> to &lt;see cref=\"int\"/>.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token comment\">/// &lt;param name=\"hashCode\">The hash code.&lt;/param></span>\n    <span class=\"token comment\">/// &lt;returns>The result of the conversion.&lt;/returns></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">implicit</span> <span class=\"token keyword\">operator</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HashCode</span> hashCode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> hashCode<span class=\"token punctuation\">.</span><span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Implements the operator ==.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token comment\">/// &lt;param name=\"left\">The left.&lt;/param></span>\n    <span class=\"token comment\">/// &lt;param name=\"right\">The right.&lt;/param></span>\n    <span class=\"token comment\">/// &lt;returns>The result of the operator.&lt;/returns></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">bool</span> <span class=\"token keyword\">operator</span> <span class=\"token operator\">==</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HashCode</span> left<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HashCode</span> right<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> left<span class=\"token punctuation\">.</span><span class=\"token function\">Equals</span><span class=\"token punctuation\">(</span>right<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Implements the operator !=.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token comment\">/// &lt;param name=\"left\">The left.&lt;/param></span>\n    <span class=\"token comment\">/// &lt;param name=\"right\">The right.&lt;/param></span>\n    <span class=\"token comment\">/// &lt;returns>The result of the operator.&lt;/returns></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">bool</span> <span class=\"token keyword\">operator</span> <span class=\"token operator\">!=</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HashCode</span> left<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HashCode</span> right<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>left <span class=\"token operator\">==</span> right<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Takes the hash code of the specified item.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token comment\">/// &lt;typeparam name=\"T\">The type of the item.&lt;/typeparam></span>\n    <span class=\"token comment\">/// &lt;param name=\"item\">The item.&lt;/param></span>\n    <span class=\"token comment\">/// &lt;returns>The new hash code.&lt;/returns></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> HashCode <span class=\"token generic-method\"><span class=\"token function\">Of</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> item<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashCode</span><span class=\"token punctuation\">(</span><span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Takes the hash code of the specified items.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token comment\">/// &lt;typeparam name=\"T\">The type of the items.&lt;/typeparam></span>\n    <span class=\"token comment\">/// &lt;param name=\"items\">The collection.&lt;/param></span>\n    <span class=\"token comment\">/// &lt;returns>The new hash code.&lt;/returns></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> HashCode <span class=\"token generic-method\"><span class=\"token function\">OfEach</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>IEnumerable<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> items<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        items <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">?</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashCode</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashCode</span><span class=\"token punctuation\">(</span><span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Adds the hash code of the specified item.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token comment\">/// &lt;typeparam name=\"T\">The type of the item.&lt;/typeparam></span>\n    <span class=\"token comment\">/// &lt;param name=\"item\">The item.&lt;/param></span>\n    <span class=\"token comment\">/// &lt;returns>The new hash code.&lt;/returns></span>\n    <span class=\"token keyword\">public</span> HashCode <span class=\"token generic-method\"><span class=\"token function\">And</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> item<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashCode</span><span class=\"token punctuation\">(</span><span class=\"token function\">CombineHashCodes</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">value</span><span class=\"token punctuation\">,</span> <span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Adds the hash code of the specified items in the collection.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token comment\">/// &lt;typeparam name=\"T\">The type of the items.&lt;/typeparam></span>\n    <span class=\"token comment\">/// &lt;param name=\"items\">The collection.&lt;/param></span>\n    <span class=\"token comment\">/// &lt;returns>The new hash code.&lt;/returns></span>\n    <span class=\"token keyword\">public</span> HashCode <span class=\"token generic-method\"><span class=\"token function\">AndEach</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>IEnumerable<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> items<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>items <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashCode</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashCode</span><span class=\"token punctuation\">(</span><span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/// &lt;inheritdoc /></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">bool</span> <span class=\"token function\">Equals</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HashCode</span> other<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">value</span><span class=\"token punctuation\">.</span><span class=\"token function\">Equals</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">.</span><span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;inheritdoc /></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">bool</span> <span class=\"token function\">Equals</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">object</span> obj<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>obj <span class=\"token keyword\">is</span> HashCode<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">Equals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>HashCode<span class=\"token punctuation\">)</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Throws &lt;see cref=\"NotSupportedException\" />.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token comment\">/// &lt;returns>Does not return.&lt;/returns></span>\n    <span class=\"token comment\">/// &lt;exception cref=\"NotSupportedException\">Implicitly convert this struct to an &lt;see cref=\"int\" /> to get the hash code.&lt;/exception></span>\n    <span class=\"token punctuation\">[</span><span class=\"token class-name\">EditorBrowsable</span><span class=\"token punctuation\">(</span>EditorBrowsableState<span class=\"token punctuation\">.</span>Never<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">int</span> <span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NotSupportedException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Implicitly convert this struct to an int to get the hash code.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">CombineHashCodes</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> h1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> h2<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">unchecked</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Code copied from System.Tuple so it must be the best way to combine hash codes or at least a good one.</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>h1 <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> h1<span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> h2<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token generic-method\"><span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> item<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> item<span class=\"token punctuation\">?.</span><span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token generic-method\"><span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>IEnumerable<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> items<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> startHashCode<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> temp <span class=\"token operator\">=</span> startHashCode<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">var</span> enumerator <span class=\"token operator\">=</span> items<span class=\"token punctuation\">.</span><span class=\"token function\">GetEnumerator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>enumerator<span class=\"token punctuation\">.</span><span class=\"token function\">MoveNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            temp <span class=\"token operator\">=</span> <span class=\"token function\">CombineHashCodes</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">,</span> <span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span>enumerator<span class=\"token punctuation\">.</span>Current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>enumerator<span class=\"token punctuation\">.</span><span class=\"token function\">MoveNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                temp <span class=\"token operator\">=</span> <span class=\"token function\">CombineHashCodes</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">,</span> <span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span>enumerator<span class=\"token punctuation\">.</span>Current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span>\n        <span class=\"token punctuation\">{</span>\n            temp <span class=\"token operator\">=</span> <span class=\"token function\">CombineHashCodes</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">,</span> EmptyCollectionPrimeNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> temp<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The helper struct can be used in our SuperHero class like so:</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">int</span> <span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> HashCode\n        <span class=\"token punctuation\">.</span><span class=\"token function\">Of</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">And</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">AndEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>powers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now isn't that pretty? All the nasty magic numbers and <code class=\"language-text\">unchecked</code> code has been hidden away. It is a very lightweight and simple <code class=\"language-text\">struct</code>, so although we create new instances of it, it's stored in the stack rather than the memory heap. What's more, is that is code is just as fast (I've timed it)! We're using generics so there is no boxing or unboxing going on. We're still using the <code class=\"language-text\">unchecked</code> keyword, so overflow checking is still disabled.</p>\n<p>One interesting edge case is what to do when hashing a collection and you get either a <code class=\"language-text\">null</code> or empty collection. Should you use a zero to represent both scenarios (zero is usually used to represent a <code class=\"language-text\">null</code> value) or differentiate them somehow. I managed to get a response from Jon Skeet himself on StackOverflow:</p>\n<blockquote>\n<p>if both states are valid, it seems perfectly reasonable to differentiate between them. (Someone carrying an empty box isn't the same as someone not carrying a box at all...)</p>\n<p><a href=\"https://stackoverflow.com/questions/8094867/good-gethashcode-override-for-list-of-foo-objects-respecting-the-order/8094931?noredirect=1#comment99700237_8094931\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Jon Skeet</a></p>\n</blockquote>\n<p>This is why we use the prime number 19 (it could have been any prime number) to represent an empty collection. Whether this matters or not depends on your use case. If an empty collection means something different in your scenario, then we've got you covered. Generally speaking though, if you are exposing a collection property in your class you should consider making it a getter only and initializing it in the constructor, so that it is never <code class=\"language-text\">null</code> in the first place but here we're trying to cover all scenarios.</p>\n<h1 id=\"net-core-hashcode\"><a href=\"#net-core-hashcode\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>.NET Core HashCode</h1>\n<p>If you are using .NET Core 2.1, consider using the <a href=\"https://docs.microsoft.com/en-us/dotnet/api/system.hashcode?view=netcore-2.1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">System.HashCode</a> <code class=\"language-text\">struct</code> instead of my code. There are two ways to use it:</p>\n<h2 id=\"hashcodecombine\"><a href=\"#hashcodecombine\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>HashCode.Combine</h2>\n<p>The <code class=\"language-text\">Combine</code> method can be used to create a hash code, given up to eight objects.</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">int</span> <span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  HashCode<span class=\"token punctuation\">.</span><span class=\"token function\">Combine</span><span class=\"token punctuation\">(</span>object1<span class=\"token punctuation\">,</span> object2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"hashcodeadd\"><a href=\"#hashcodeadd\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>HashCode.Add</h2>\n<p>The Add method is similar to my code but it does not handle collections and is not fluent:</p>\n<div class=\"line-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">int</span> <span class=\"token function\">GetHashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> hash <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    hash<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>object1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    hash<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>object2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> hash<span class=\"token punctuation\">.</span><span class=\"token function\">ToHashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"advantages-and-disadvantages\"><a href=\"#advantages-and-disadvantages\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Advantages and Disadvantages</h2>\n<p>There are several advantages to using the .NET Core <code class=\"language-text\">HashCode</code>:</p>\n<ul>\n<li>It's part of the .NET Core base class library (BCL), so it's maintained and officially supported.</li>\n<li>It has good performance. I haven't written a benchmark against comparing my code to the .NET Core code. If you do, I'd be interested to hear the results.</li>\n<li>Like my code, it handles <code class=\"language-text\">null</code>'s automatically.</li>\n</ul>\n<p>The disadvantages are:</p>\n<ul>\n<li>You have to be using .NET Core 2.1 or above.</li>\n<li>It does not handle collections, you have to write a for loop to handle that yourself. You could be clever and write a quick extension method to handle this scenario.</li>\n<li>It's not fluent, so you end up with slightly uglier code in my opinion. If you are a fan of C# 7 expression bodied members, then my fluent code lets you use them, while the .NET Core <code class=\"language-text\">HashCode.Add</code> method does not.</li>\n</ul>\n<h1 id=\"license\"><a href=\"#license\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>License</h1>\n<p>I've been asked repeatedly for licensing of my code above. Developers have been asking permission to use it in a Kerbal Space program plugin and even in the excellent <a href=\"https://chocolatey.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Chocolatey</a> project which has been totally unexpected for me because this is code I wrote years ago. It just goes to show how fundamental <code class=\"language-text\">GetHashCode</code> is. Please consider the code as MIT licensed, do good with it and be excellent to each other!</p>\n"}}]}}},"context":{}}