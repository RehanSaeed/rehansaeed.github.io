{"hash":"5b5c9901b91b359d72de3bc5cf745eb26b300f4d","data":{"tag":{"title":"Kibana","path":"/tag/kibana/","belongsTo":{"edges":[{"node":{"title":"Useful Docker Images - Part 2","path":"/useful-docker-images-part2/","date":"11 December 2017","timeToRead":5,"description":"How to run the ELK-B Stack, made up of ElasticSearch, Kibana, Filebeat, Metricbeat and Heartbeat using Docker and Docker Swarm.","content":"<ol>\n<li><a href=\"/useful-docker-images-part1/\">Useful Docker Images - Part 1 - Administering Docker</a></li>\n<li><a href=\"/useful-docker-images-part2/\">Useful Docker Images - Part 2 - The EKL-B Stack</a></li>\n</ol>\n<h1 id=\"filebeat-metricbeat--hearbeat\"><a href=\"#filebeat-metricbeat--hearbeat\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Filebeat, Metricbeat &#x26; Hearbeat</h1>\n<p>Knowing what is happening in Docker and in your applications running on Docker is critical. To collect logs from my Swarm and monitor the health of it, I use the ELK-B stack which is made up of four pieces of software called <a href=\"https://www.elastic.co/products/elasticsearch\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ElasticSearch</a>, <a href=\"https://www.elastic.co/products/logstash\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">LogStash</a> (I recommend that you use Beats instead of LogStash), <a href=\"https://www.elastic.co/products/kibana\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Kibana</a> and various <a href=\"https://www.elastic.co/products/beats\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Beats</a>.</p>\n<p>ElasticSearch is basically a No-SQL database that is geared towards storing JSON documents and searching across them. Kibana is a visualization took that gives you a nice UI to view all of your data and produce nice visualizations and dashboards. There are several Beats which are used to ship data into ElasticSearch from various sources.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1000 560' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-0ebc5c31f11e53052d650c4d1e8106f8'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-0ebc5c31f11e53052d650c4d1e8106f8)' width='1000' height='560' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAkAEADASIAAhEBAxEB/8QAGwAAAQUBAQAAAAAAAAAAAAAAAAMEBQYHAQL/xAA2EAACAQMCAwQIAwkAAAAAAAABAgMABBESIQUTMQYiQVEIMmFxgZGh8AdS0RQVIyQzNEJUwf/EABgBAAMBAQAAAAAAAAAAAAAAAAADBAEC/8QAIhEAAgEDBAIDAAAAAAAAAAAAAAECAxEhBBJBURMzUpGh/9oADAMBAAIRAxEAPwDTfwIunu%2bzF/LHaQxO12AIowyLtbxY69M9T57%2bdatbcwJiVFTHQBtVZH6Pc%2brsdezKgIjvDkIoO/Ij8B7fZmr%2beKylsGO7yuT/AGz/AKU6ukqjyTaPdKhFpXLFSUzABU1FS50gr1HtqDl4m0kKAxXIC/5CB8k/KkjetJJl4bzWOhaB9/dtS1bllDjU4iyxRRshOqWSTbHfx/wClPvpVcbiMh303hA8oX/SvS8UkaBlMV13vzQPqI9m1ZZdm7Z/Flh%2b%2blGM7EbVXBxOVTsl5sP9dyB9KkuGXklzMwdJFULnvRMo6%2bZFGOwtLmLMs9HiQ2vYriBUSn%2bd1YRct/QiOwJOfn8B0rUluVWVgLedpmTPMMOx3xg4rJfRzLWnYe/cqGZeIOwC97rDHjp7%2blaibm9fKMk6y51LohOAemk%2bBG/XI8KbXT8jsT6JXoRHdoDMmho4TAp3AQjJ8xmn3LTmCTQNYGAceFQ3NngTTamdkQZCPARjzDMevw%2bte0u7pXBALRM3V4WAXPkRufkPDcUqz6KrLhkg8MUSOZGRYdy4IAHvJrsDWt1Gktu8UqLsjxkMB7iKg%2bK2/wC8OOypewPPY2VukyQFCySyMzZJHRioUYHm2fKn1qEWISW1m1ry3A0CPRqBO%2b31ruUVFLsRCcpyeML7HkvItUlmuZYo4j67PhR8TSts8MlujWro0JGVaMgqR7DVWmtV4jx7iV3xWze7hsZUt7S3eMuigorNKFOzMS2M%2bAXbxqasdKiJre1e2TXyjHy9AIxkHH340iMnLPBVUhGCSvd/mcmc%2bjlGg7H3y6cj9rRsE535ER8a1VY8TM%2bpzkeqTsPhRRVFf2Mh0npicWHCyDmSHUfFvV91Bi/gBOZJn8%2brvUUUopFVGFA3OPOu0UUAFFFFAH//2Q==' /%3e%3c/svg%3e\" width=\"1000\" alt=\"Kibana\" data-srcset=\"/assets/static/Kibana.82a2fbd.1b0079770fb42e6b2214073d91727863.jpg 480w, /assets/static/Kibana.97c148e.1b0079770fb42e6b2214073d91727863.jpg 1000w\" data-sizes=\"(max-width: 1000px) 100vw, 1000px\" data-src=\"/assets/static/Kibana.97c148e.1b0079770fb42e6b2214073d91727863.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/Kibana.97c148e.1b0079770fb42e6b2214073d91727863.jpg\" width=\"1000\" alt=\"Kibana\"></noscript></p>\n<p>While you could use Docker to host ElasticSearch and Kibana, I use the <a href=\"https://www.elastic.co/cloud\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ElasticCloud</a> at work, you could also use instances hosted by AWS and Azure. Using a hosted version takes some of the pain out of maintaining ElasticSearch. I had a look at the ElasticSearch Docker container and if you really want to go down the Docker route and create an ElasticSearch cluster, it looks fairly straightforward but a bit unorthodox. There is a cost versus effort trade-off in this decision and it's up to you where you decide to go.</p>\n<p>In terms of Beats, I use three of them which I'll talk about below:</p>\n<h2 id=\"filebeat\"><a href=\"#filebeat\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Filebeat</h2>\n<p><a href=\"https://www.elastic.co/products/beats/filebeat\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Filebeat</a> is a tool used to ship Docker log files to ElasticSearch. The latest version 6.0 queries Docker APIs and enriches these logs with the container name, image, labels, and so on which is a great feature, because you can then filter and search your logs by these properties. You can then view these logs in a fully customizable Kibana dashboard. Filebeat ships with a sample Kibana dashboard that looks like this:</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1000 560' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-915897634da8d98f5b11d484f35ba7bd'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-915897634da8d98f5b11d484f35ba7bd)' width='1000' height='560' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAkAEADASIAAhEBAxEB/8QAGwAAAgIDAQAAAAAAAAAAAAAAAAQGBwEDBQL/xAAvEAACAQMCAwcCBwEAAAAAAAABAgMABBEFEgYhMQcTFCJBUWEIsTJCUnGBocGS/8QAGAEAAgMAAAAAAAAAAAAAAAAAAAMBAgT/xAAmEQACAQIFAgcAAAAAAAAAAAAAAQIDEQQTITNxEiIxQVFhgaHw/9oADAMBAAIRAxEAPwC2uxaZ5eCIpbmG3R3uZiVCBAB5RyX0qfKts2cx26gfqwP9qBfT8Hfs8g3uc%2bJm6Ae4qxEYtdSw73GxVbPl55z8fFNrWzGZsM3lRv6GA0ax7A9uE/TnlXpYFKgqkJXHLA%2bc0wBy96zSjSL%2bHG7d3cW4DGcVgWqg5EUOf2pmvEgIyxkKKOfp/tACzWSEACOJflRilrvSVuIwolmhIZW3wvsbkemcdD0NRpeOWvZJn0bTNQvrKIkG5UBVfHqo2nl7E4z%2b3OpNw9rFtrdh4i0kfk210cANG3scferOLV/YoqkHLpT1IF9OjM/Zxbs7Fibmfmev4hViWrrJqd0yMGHdxjI9wXBqt/p7Vh2aW6MsgJupj5W2n8QNWPZ2UNqG7sSRDAHmfOeZP3Jq1fcfIjDJulDgeopcqx5RS7j1OWrKDBIeX%2bA1LNJvrncR2s19w/qdpattnntpIoznGGZSB/ZpwoFzulYZ6ZbpWV3BFEbB8dSx61MW4tNEpkG4F4h0zTuG4bG%2bYWN1agrLC6nOc/HU%2bn8Uz2fhrnUNb1OGNorK6mHcgjG7BOT/AH9/au/e6NZX04mvNPsppR%2bd0yftTkD92gRURI18oVARj2wMVbtV7ef75%2bjPCjJNXei8CtOxIdx2f2ipnldS4JPPmAanPfO4ZXO4bc4JJ9qKKmtuMnC7MeDp2kcawoyIisyjJUYzWq2iikeZnijZhIcEqCaKKWPPGqgFYgQDlj1rRYHdIEGUVskhCR6UUUAdHw4znvJf%2bzW2iigD/9k=' /%3e%3c/svg%3e\" width=\"1000\" alt=\"Filebeat Kibana Dashboard\" data-srcset=\"/assets/static/Filebeat-Kibana-Dashboard.82a2fbd.578c653a6c6f2cc34b478714811b5189.jpg 480w, /assets/static/Filebeat-Kibana-Dashboard.97c148e.578c653a6c6f2cc34b478714811b5189.jpg 1000w\" data-sizes=\"(max-width: 1000px) 100vw, 1000px\" data-src=\"/assets/static/Filebeat-Kibana-Dashboard.97c148e.578c653a6c6f2cc34b478714811b5189.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/Filebeat-Kibana-Dashboard.97c148e.578c653a6c6f2cc34b478714811b5189.jpg\" width=\"1000\" alt=\"Filebeat Kibana Dashboard\"></noscript></p>\n<p>As well as shipping Docker logs, I write the logs from my ASP.NET Core applications to disk (The best way to make sure you never lose log information) and then use Filebeat to ship these log files to ElasticSearch.</p>\n<p>The <code class=\"language-text\">Dockerfile</code> below is used to add Filebeat configuration files to the base Filebeat image and nothing more. The configuration files are pretty lengthy and heavily commented so I've omitted them:</p>\n<div class=\"line-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">FROM</span> docker.elastic.co/beats/filebeat<span class=\"token punctuation\">:</span>6.0.0\n<span class=\"token keyword\">COPY</span> filebeat.yml filebeat.template.json /usr/share/filebeat/\n<span class=\"token keyword\">USER</span> root\n<span class=\"token keyword\">RUN</span> chown filebeat /usr/share/filebeat/filebeat.yml &amp;&amp; /\n    chown filebeat /usr/share/filebeat/filebeat.template.json &amp;&amp; /\n    chmod go<span class=\"token punctuation\">-</span>w /usr/share/filebeat/filebeat.yml &amp;&amp; /\n    chmod go<span class=\"token punctuation\">-</span>w /usr/share/filebeat/filebeat.template.json\n<span class=\"token keyword\">USER</span> filebeat</code></pre></div>\n<p>In the Docker stack file below, I setup a shared volume called 'logs' in which my website container stores all of it's log files. My custom Filebeat image then picks up logs from the 'logs' volume and pushes them to ElasticSearch. Filebeat is also configured so that one instance of the container runs on every Docker node, so that it can pick up Docker logs from every node in my Swarm.</p>\n<div class=\"line-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.3'</span>\n\n  <span class=\"token key atrule\">filebeat</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>custom<span class=\"token punctuation\">-</span>filebeat<span class=\"token punctuation\">-</span>image<span class=\"token punctuation\">:</span>latest\n    <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> global <span class=\"token comment\"># One docker container per node</span>\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> defaultoverlay\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> logs<span class=\"token punctuation\">:</span>/var/log/my<span class=\"token punctuation\">-</span>company<span class=\"token punctuation\">-</span>name\n      \n  <span class=\"token key atrule\">website-name</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> website<span class=\"token punctuation\">-</span>name<span class=\"token punctuation\">:</span>latest\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"5000:80\"</span>\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> defaultoverlay\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> logs<span class=\"token punctuation\">:</span>/var/log/my<span class=\"token punctuation\">-</span>company<span class=\"token punctuation\">-</span>name\n      \n<span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">defaultoverlay</span><span class=\"token punctuation\">:</span>\n  \n<span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n  logs<span class=\"token punctuation\">:</span></code></pre></div>\n<h2 id=\"metricbeat\"><a href=\"#metricbeat\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Metricbeat</h2>\n<p><a href=\"https://www.elastic.co/downloads/beats/metricbeat\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Metricbeat</a> can be used to monitor the CPU, memory and disk usage on your Docker nodes and then ship those logs to your ElasticSearch cluster. Once again Metricbeat ships with a sample Kibana dashboard that looks like this:</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1000 560' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-6c53d1ba85513cae41addc7452e102ae'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-6c53d1ba85513cae41addc7452e102ae)' width='1000' height='560' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAkAEADASIAAhEBAxEB/8QAGwAAAQUBAQAAAAAAAAAAAAAAAAECAwQHBQb/xAAzEAACAQMCBAQFAQkBAAAAAAABAgMABBESIQUTMUEGIlFhBxRxkaEVCDJCQ1KBsdHh8P/EABgBAAMBAQAAAAAAAAAAAAAAAAACAwQB/8QAIhEAAgIBAwQDAAAAAAAAAAAAAAECEQMEEiETM3HBMUFR/9oADAMBAAIRAxEAPwDUvgnK154Na4eGONjdvtCuhRhIxsMH09fWtA%2bWhGPK/wBhv%2bK8B8AJef4AMkhVj85Io1JqJ8qdNz/70rSTyhA7vyFCbsWixpHuM1XO0pyM%2bkt4o%2bB8QWMHlpGmdzg4qUGQjIC4%2btU7aaGaYRlFVmBKiS3KFgPTPWmfqcMblBIBEraDIIG5anOMaug32rN1sdXuRoknDiXBdkiMmOZGjY6Z7U0wA/yY%2b5%2b/WnSzctsNNEnoGH/aGlxGjmaMKdskbH81QCNrXLFlQIx6lcb/AFqne8JNxEipcXFsVdX1QMoYgH907dD3roJIXV9MsbFfRTt%2baSObXIU5ikjYgRkYoAyv9ntEm8B85eeMXU0Y0bdRHk9T/T9s1potVNuEf5iTBUkvgsdLahn/AB9KyT4DcOku/AkMdwqtaJd3DvBI2Fkc8vRqHcYLHHTOK0/h3DpbX5uKBo7e3miGiKNtQhl8wJUHoMaTjpkH1ptQrySTXDZPRxitPCSfNWX4YAshYm4bzahrIIHXp96jgtI47aO3CTGJY%2bVpYDBB7n3qrY8N4nBxGKafivPtwhVoeSFy2OoPX3xVG%2bsvEEniyG5tZ4E4Ujx6o3Kkuultf8OpTkrgZOcdulJtTdj0dHifBuG8RIHEOHrc4UL51yMDOO/ufvT5OHcP/To7OWyD2qkssTgEAkn39zSTwXBvJptMM2wSJZJCFVcZJxg7lu/oBV%2bENy9OsDBON87VyLb%2bgRyrdODcCWWdI4rFJmAeRmChm3xkk9etS8MuuEz3NxLw66t5ppCrTGKQMWONKk49hj%2b1S8S4aL9Yo5nJjjlWXcAhsdqtzxatBUbq4bauJy3P8GTjVNc%2bfVezMfgIiR%2bAtIUEfNMfMM9Uj/3WnBUVsqig%2bwooq%2bbuSM2l7MfAOxCMQdwCfxSa25KHO%2bRRRUjQMl0iZRoQhjvlfpUqqqnKqoPsMUUUzOL5YkjkKCD3Ap5PmUdt9qKK4B//2Q==' /%3e%3c/svg%3e\" width=\"1000\" alt=\"Metricbeat Kibana Dashboard\" data-srcset=\"/assets/static/Metricbeat-Kibana-Dashboard.82a2fbd.c97b5ac7d13df8a5c4b3d185b083fe8d.jpg 480w, /assets/static/Metricbeat-Kibana-Dashboard.97c148e.c97b5ac7d13df8a5c4b3d185b083fe8d.jpg 1000w\" data-sizes=\"(max-width: 1000px) 100vw, 1000px\" data-src=\"/assets/static/Metricbeat-Kibana-Dashboard.97c148e.c97b5ac7d13df8a5c4b3d185b083fe8d.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/Metricbeat-Kibana-Dashboard.97c148e.c97b5ac7d13df8a5c4b3d185b083fe8d.jpg\" width=\"1000\" alt=\"Metricbeat Kibana Dashboard\"></noscript></p>\n<p>Here is an example of a custom Metricbeat <code class=\"language-text\">Dockerfile</code> which I use to configure Metricbeat:</p>\n<div class=\"line-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">FROM</span> docker.elastic.co/beats/metricbeat<span class=\"token punctuation\">:</span>6.0.0\n<span class=\"token keyword\">COPY</span> metricbeat.yml metricbeat.template.json /usr/share/metricbeat/\n<span class=\"token keyword\">USER</span> root\n<span class=\"token keyword\">RUN</span> chown metricbeat /usr/share/metricbeat/metricbeat.yml &amp;&amp; /\n    chown metricbeat /usr/share/metricbeat/metricbeat.template.json &amp;&amp; /\n    chmod go<span class=\"token punctuation\">-</span>w /usr/share/metricbeat/metricbeat.yml &amp;&amp; /\n    chmod go<span class=\"token punctuation\">-</span>w /usr/share/metricbeat/metricbeat.template.json\n<span class=\"token keyword\">USER</span> metricbeat</code></pre></div>\n<p>And here is the Docker stack file below. Once again it configures one instance of Metricbeat to run on each Docker node. It also needs access to the Docker socket and a bunch of other folders on the Docker node, so that explains all of the volume mounts.</p>\n<div class=\"line-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.3'</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span> \n  <span class=\"token key atrule\">metricbeat</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>custom<span class=\"token punctuation\">-</span>metricbeat<span class=\"token punctuation\">-</span>image<span class=\"token punctuation\">:</span>latest\n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> metricbeat <span class=\"token punctuation\">-</span>e <span class=\"token punctuation\">-</span>system.hostfs=/hostfs\n    <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> global <span class=\"token comment\"># One docker container per node</span>\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> defaultoverlay\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> /proc<span class=\"token punctuation\">:</span>/hostfs/proc<span class=\"token punctuation\">:</span>ro\n      <span class=\"token punctuation\">-</span> /sys/fs/cgroup<span class=\"token punctuation\">:</span>/hostfs/sys/fs/cgroup<span class=\"token punctuation\">:</span>ro\n      <span class=\"token punctuation\">-</span> /<span class=\"token punctuation\">:</span>/hostfs<span class=\"token punctuation\">:</span>ro\n      <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/var/run/docker.sock\n      \n<span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n  defaultoverlay<span class=\"token punctuation\">:</span></code></pre></div>\n<h2 id=\"heartbeat\"><a href=\"#heartbeat\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Heartbeat</h2>\n<p><a href=\"https://www.elastic.co/products/beats/heartbeat\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Heartbeat</a> is a ping monitor that can be pointed at any status endpoints in your API's or websites. Failures get logged in ElasticSearch which show up in a nice graph. You can also use Kibana to set up alerts, so you can be notified of any downtime. Here is an example of what a Kibana Dashboard containing Heartbeat data looks like:</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1000 560' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-465482a0009652b512ca4068e11fd02d'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-465482a0009652b512ca4068e11fd02d)' width='1000' height='560' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAkAEADASIAAhEBAxEB/8QAGwAAAgMBAQEAAAAAAAAAAAAAAAcCBAYDAQX/xAA0EAACAQMCAwQJAgcAAAAAAAABAgMABBEFIQYSEwcxQVEIFBYiVWFxktEVMiNDcpHB8PH/xAAYAQADAQEAAAAAAAAAAAAAAAAAAwQFAf/EACwRAAEDAgIIBgMAAAAAAAAAAAEAAxECBCFRBRMUFTNScaESMUFhgdGRsfD/2gAMAwEAAhEDEQA/AGN2KXfrXCd7P0IbUteqvTiHIu1vFuAfPvPz38aZVtNKZUVGdgN%2bUMDtS%2b9HGQTcHX7BUAF7j3QMZ6Mee7/vnTYwPIU64EOGFNZklmklVdPd3E3M/Nh8D3s4FeRynr3S85IUZ/cPd/FXMfKjHypKpVe1Dm0HUZuZgTnO4zXkwhtrV5Lkl0QElnwTVmvhcbg%2by2oN1BGqRMzOTsoA3JrlUgYea5USBIWB4i7SpYRMmgwQxsrACWROZSAdxjIz9a0XZ3x2vFBlsdQgjttUiTqcqEmOZM4LLncYOMg92RuaRssqlOVdwQN61XZFbzT8f2ckIJS2hlkmI7grLyqD9WI/salsrit1wtViRBPSB/D5W03oupvRxfuR4XJw6GMI/PutH6NysnBt8EZVze5POD4wRHz/AN8h3U2l6xKkvGV8cKfzSO7COra9mGuOmA6XUkiupBwejGRXVeJtZAAF/cgfJqrvHg26QVi6Ms3ri3pLVMx7gftPGikf7T618Quvvo9p9a%2bIXX31LtdOS0N13nJ3H2nhXK5YCPDR9RWPKy4zsflSU9p9a%2bIXX30e0%2btfELr76NrpyRuu85O4%2b1qtR7K9CubppbX9SsUY5MNvInTH9IYHl%2bg2rVcM6Dp3DdobXS7OSJZG5pZXYM7nHezE5P8Aist2eapqGqajeQ3t5PIgg5l5m7jzDcVvkt2VgWmkYDwJ2qql8u0zn365/KQ/r2zqnicPSZSm9HphDwheIqgqbtSQ2T/Ii86bEMMTxhjFHnJOy%2bNFFNf4hWfacGlT9Xh8I0HiCFG1chZRjGGbbu2X8UUUpUSpR2kSEbc2BgAgfipi3hGP4SbDH7R3UUUIkqSRRocoiqcYyBjapMcKSKKKEL//2Q==' /%3e%3c/svg%3e\" width=\"1000\" alt=\"Heartbeat Kibana Dashboard\" data-srcset=\"/assets/static/Heartbeat-Kibana-Dashboard.82a2fbd.469a55c8aa411028459dcc712d9f7d69.jpg 480w, /assets/static/Heartbeat-Kibana-Dashboard.97c148e.469a55c8aa411028459dcc712d9f7d69.jpg 1000w\" data-sizes=\"(max-width: 1000px) 100vw, 1000px\" data-src=\"/assets/static/Heartbeat-Kibana-Dashboard.97c148e.469a55c8aa411028459dcc712d9f7d69.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/Heartbeat-Kibana-Dashboard.97c148e.469a55c8aa411028459dcc712d9f7d69.jpg\" width=\"1000\" alt=\"Heartbeat Kibana Dashboard\"></noscript></p>\n<p>The Dockerfile is similar to the other Beats:</p>\n<div class=\"line-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">FROM</span> docker.elastic.co/beats/heartbeat<span class=\"token punctuation\">:</span>6.0.0\n<span class=\"token keyword\">COPY</span> heartbeat.yml heartbeat.template.json /usr/share/heartbeat/\n<span class=\"token keyword\">USER</span> root\n<span class=\"token keyword\">RUN</span> chown heartbeat /usr/share/heartbeat/heartbeat.yml &amp;&amp; /\n    chown heartbeat /usr/share/heartbeat/heartbeat.template.json &amp;&amp; /\n    chmod go<span class=\"token punctuation\">-</span>w /usr/share/heartbeat/heartbeat.yml &amp;&amp; /\n    chmod go<span class=\"token punctuation\">-</span>w /usr/share/heartbeat/heartbeat.template.json\n<span class=\"token keyword\">USER</span> heartbeat</code></pre></div>\n<p>This Docker stack file is extremely simple. There is only one instance of the image required.</p>\n<div class=\"line-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.3'</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span> \n  <span class=\"token key atrule\">heartbeat</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>custom<span class=\"token punctuation\">-</span>heartbeat<span class=\"token punctuation\">-</span>image<span class=\"token punctuation\">:</span>latest\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> defaultoverlay\n      \n<span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n  defaultoverlay<span class=\"token punctuation\">:</span></code></pre></div>\n<p>Ping monitors on the internet are super <a href=\"https://www.pingdom.com/free\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">expensive</a> for what they are, this is because they send pings from various locations on the Earth. Heartbeat will not do that, so be aware of this difference. That said, there is nothing I can do if the pipe for the internet in Australia goes down, so in my opinion, Heartbeat reduces a lot of false positives.</p>\n<h1 id=\"conclusions\"><a href=\"#conclusions\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusions</h1>\n<p>I've discovered that I have enough material for a third and final part to this series of blog posts. In the next part, you can expect to learn more about Redis and Metabase Docker images.</p>\n"}}]}}},"context":{}}