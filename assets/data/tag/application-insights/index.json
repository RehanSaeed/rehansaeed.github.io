{"hash":"590b14cfd912e045a4607f8f1d167f51c1d0b7f7","data":{"tag":{"title":"Application Insights","path":"/tag/application-insights/","belongsTo":{"edges":[{"node":{"title":"Making Application Insights Fast & Secure","path":"/making-application-insights-fast-and-secure/","date":"11 December 2016","timeToRead":4,"description":"Implementing Application Insights into your ASP.NET Core application with performance and security as a top priority in this advanced scenario.","content":"<h1 id=\"what-is-application-insights\"><a href=\"#what-is-application-insights\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is Application Insights?</h1>\n<p>It's an application monitoring tool available on Microsoft's Azure cloud that you can use to detect errors and usage in your application. For ASP.NET Core apps, it can do this for both your C# and JavaScript code. It's main competitors are <a href=\"https://newrelic.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">New Relic</a> and <a href=\"https://raygun.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">RayGun</a>.</p>\n<h1 id=\"implementing-application-insights\"><a href=\"#implementing-application-insights\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Implementing Application Insights</h1>\n<p>Following the <a href=\"https://github.com/Microsoft/ApplicationInsights-aspnetcore/wiki/Getting-Started\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Getting Started</a> guide for ASP.NET Core applications requires you to add the following HTML helper to your <code class=\"language-text\">_Layout.cshtml</code> file:</p>\n<div class=\"line-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    @* ...Omitted *@\n\n    @Html.ApplicationInsightsJavaScript(TelemetryConfiguration) \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>This HTML helper adds an inline script containing the minified JavaScript in <a href=\"https://github.com/Microsoft/ApplicationInsights-JS/blob/master/JavaScript/JavaScriptSDK/snippet.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">snippet.js</a>.</p>\n<div class=\"line-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">var</span> appInsights<span class=\"token operator\">=</span>window<span class=\"token punctuation\">.</span>appInsights<span class=\"token operator\">||</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">function</span> <span class=\"token function\">i</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>t<span class=\"token punctuation\">[</span>config<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span> i<span class=\"token operator\">=</span>arguments<span class=\"token punctuation\">;</span>t<span class=\"token punctuation\">.</span>queue<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>t<span class=\"token punctuation\">[</span>config<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token keyword\">var</span> t<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>config<span class=\"token operator\">:</span>config<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>u<span class=\"token operator\">=</span>document<span class=\"token punctuation\">,</span>e<span class=\"token operator\">=</span>window<span class=\"token punctuation\">,</span>o<span class=\"token operator\">=</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">,</span>s<span class=\"token operator\">=</span><span class=\"token string\">\"AuthenticatedUserContext\"</span><span class=\"token punctuation\">,</span>h<span class=\"token operator\">=</span><span class=\"token string\">\"start\"</span><span class=\"token punctuation\">,</span>c<span class=\"token operator\">=</span><span class=\"token string\">\"stop\"</span><span class=\"token punctuation\">,</span>l<span class=\"token operator\">=</span><span class=\"token string\">\"Track\"</span><span class=\"token punctuation\">,</span>a<span class=\"token operator\">=</span>l<span class=\"token operator\">+</span><span class=\"token string\">\"Event\"</span><span class=\"token punctuation\">,</span>v<span class=\"token operator\">=</span>l<span class=\"token operator\">+</span><span class=\"token string\">\"Page\"</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">=</span>u<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">;</span>y<span class=\"token punctuation\">.</span>src<span class=\"token operator\">=</span>config<span class=\"token punctuation\">.</span>url<span class=\"token operator\">||</span><span class=\"token string\">\"https://az416426.vo.msecnd.net/scripts/a/ai.0.js\"</span><span class=\"token punctuation\">;</span>u<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">try</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>t<span class=\"token punctuation\">.</span>cookie<span class=\"token operator\">=</span>u<span class=\"token punctuation\">.</span>cookie<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span>queue<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">.</span>version<span class=\"token operator\">=</span><span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>r<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"Event\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Exception\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Metric\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"PageView\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Trace\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Dependency\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>r<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span><span class=\"token function\">i</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"track\"</span><span class=\"token operator\">+</span>r<span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">return</span> <span class=\"token function\">i</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"set\"</span><span class=\"token operator\">+</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token function\">i</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"clear\"</span><span class=\"token operator\">+</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token function\">i</span><span class=\"token punctuation\">(</span>h<span class=\"token operator\">+</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token function\">i</span><span class=\"token punctuation\">(</span>c<span class=\"token operator\">+</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token function\">i</span><span class=\"token punctuation\">(</span>h<span class=\"token operator\">+</span>v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token function\">i</span><span class=\"token punctuation\">(</span>c<span class=\"token operator\">+</span>v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token function\">i</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flush\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>config<span class=\"token punctuation\">.</span>disableExceptionTracking<span class=\"token operator\">||</span><span class=\"token punctuation\">(</span>r<span class=\"token operator\">=</span><span class=\"token string\">\"onerror\"</span><span class=\"token punctuation\">,</span><span class=\"token function\">i</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"_\"</span><span class=\"token operator\">+</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>f<span class=\"token operator\">=</span>e<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>e<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config<span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">,</span>u<span class=\"token punctuation\">,</span>e<span class=\"token punctuation\">,</span>o</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span> s<span class=\"token operator\">=</span>f<span class=\"token operator\">&amp;</span>amp<span class=\"token punctuation\">;</span><span class=\"token operator\">&amp;</span>amp<span class=\"token punctuation\">;</span><span class=\"token function\">f</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">,</span>u<span class=\"token punctuation\">,</span>e<span class=\"token punctuation\">,</span>o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">return</span> s<span class=\"token operator\">!==</span><span class=\"token operator\">!</span><span class=\"token number\">0</span><span class=\"token operator\">&amp;</span>amp<span class=\"token punctuation\">;</span><span class=\"token operator\">&amp;</span>amp<span class=\"token punctuation\">;</span>t<span class=\"token punctuation\">[</span><span class=\"token string\">\"_\"</span><span class=\"token operator\">+</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">,</span>u<span class=\"token punctuation\">,</span>e<span class=\"token punctuation\">,</span>o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>s<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>t\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n        instrumentationKey<span class=\"token operator\">:</span> <span class=\"token string\">'{0}'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    window<span class=\"token punctuation\">.</span>appInsights<span class=\"token operator\">=</span>appInsights<span class=\"token punctuation\">;</span>\n    appInsights<span class=\"token punctuation\">.</span><span class=\"token function\">trackPageView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>This script is responsible for:</p>\n<ol>\n<li>Containing the users instrumentation key (The HTML helper adds this for you).</li>\n<li>Downloading the full application insights script asynchronously which actually does all the work.</li>\n<li>Recording any logs that occur while the full script is downloaded</li>\n</ol>\n<h1 id=\"the-problem\"><a href=\"#the-problem\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Problem</h1>\n<p>For most websites, this is fine and you can stop here. Here is what can be improved for the rest:</p>\n<ol>\n<li>The above adds 1KB to every HTML page. Moving this script into a separate file would mean that this script could be cached in the browser the first time it was downloaded. A separate file could also be distributed to a CDN and globally distributed very quickly.</li>\n<li>If you are using a <a href=\"/content-security-policy-for-asp-net-mvc/\">Content Security Policy (CSP)</a> to secure your site using inline scripts in your site is a big no no. You could use a nonce (A nonce means you can't cache the page as each page becomes unique) or even better a hash of the script contents but browser support for CSP 2.0 is not great. Using an external script would be the simplest option.</li>\n</ol>\n<h1 id=\"making-it-slightly-faster-and-more-secure\"><a href=\"#making-it-slightly-faster-and-more-secure\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Making It Slightly Faster and More Secure</h1>\n<p>So what does it take to move the above <code class=\"language-text\">snippet.js</code> file into a separate file? Well, it turns out that you can get <code class=\"language-text\">snippet.js</code> from the <a href=\"https://www.npmjs.com/package/applicationinsights-js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">applicationinsights-js</a> NPM package which you can add to your <code class=\"language-text\">package.json</code> like so:</p>\n<div class=\"line-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"applicationinsights-js\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.5\"</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The next step is to inject your instrumentation key into <code class=\"language-text\">snippet.js</code> and also the URL to the full application insights script which is missing from the <code class=\"language-text\">snippet.js</code> file in the NPM package. I do this using a gulp task like so:</p>\n<div class=\"line-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> gulp <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    sourcemaps <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp-sourcemaps'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>    <span class=\"token comment\">// Creates source map files (https://www.npmjs.com/package/gulp-sourcemaps/)</span>\n    replace <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp-replace-task'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token comment\">// String replace (https://www.npmjs.com/package/gulp-replace-task/)</span>\n    uglify <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp-uglify'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">// Minifies JavaScript (https://www.npmjs.com/package/gulp-uglify/)</span>\n\ngulp<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'build-app-insights-js'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> gulp\n            <span class=\"token punctuation\">.</span><span class=\"token function\">src</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./node_modules/ApplicationInsights-JS/JavaScript/JavaScriptSDK/snippet.js'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>sourcemaps<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>               <span class=\"token comment\">// Set up the generation of .map source files for the JavaScript.</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>\n                <span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>                          <span class=\"token comment\">// Carry out the specified find and replace.</span>\n                    patterns<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                        <span class=\"token punctuation\">{</span>\n                            <span class=\"token comment\">// match - The string or regular expression to find.</span>\n                            match<span class=\"token operator\">:</span> <span class=\"token string\">'CDN_PATH'</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token comment\">// replacement - The string or function used to make the replacement.</span>\n                            replacement<span class=\"token operator\">:</span> <span class=\"token string\">'https://az416426.vo.msecnd.net/scripts/a/ai.0.js'</span>\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">{</span>\n                           match<span class=\"token operator\">:</span> <span class=\"token string\">'INSTRUMENTATION_KEY'</span><span class=\"token punctuation\">,</span>\n                           replacement<span class=\"token operator\">:</span> <span class=\"token string\">'11111111-2222-3333-4444-555555555555'</span>\n                        <span class=\"token punctuation\">}</span>\n                    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                    usePrefix<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">uglify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>                        <span class=\"token comment\">// Minifies the JavaScript.</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>sourcemaps<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>           <span class=\"token comment\">// Generates source .map files for the JavaScript.</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token function\">dest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./wwwroot/js/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\">// Saves the JavaScript file to the specified destination path.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Finally we can include the script in our HTML. Don't forget to include the <code class=\"language-text\">crossorigin</code> attribute on all your script tags, which allows full stack traces to be reported. You can read more about the <code class=\"language-text\">crossorigin</code> attribute <a href=\"https://raygun.com/blog/2015/05/fixing-script-errors/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>.</p>\n<div class=\"line-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">asp-append-version</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">crossorigin</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>anonymous<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>~/js/application-insights.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h1 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"aria-hidden\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h1>\n<p>As usual, all of the above is built in to the <a href=\"https://github.com/ASP-NET-MVC-Boilerplate/Templates\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ASP.NET Core Boilerplate</a> project template, available as a <a href=\"https://visualstudiogallery.msdn.microsoft.com/6cf50a48-fc1e-4eaf-9e82-0b2a6705ca7d\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Visual Studio extension</a> if you select the optional Application Insights feature.</p>\n"}}]}}},"context":{}}