{"hash":"ff8e1fa27339c5a402548be5ef3088dc560810f9","data":{"post":{"title":"Docker Labels in Depth","path":"/docker-labels-depth/","date":"2017-11-20T00:00:00+00:00","dateModified":null,"timeToRead":3,"author":"Muhammad Rehan Saeed","headings":[{"value":"Static Docker Labels"},{"value":"Dynamic Docker Labels"},{"value":"Open Containers Annotations Spec"},{"value":"Naming Conventions"}],"tags":[{"id":"Docker","title":"Docker","path":"/tag/docker/"},{"id":"Docker Compose","title":"Docker Compose","path":"/tag/docker-compose/"},{"id":"Docker Swarm","title":"Docker Swarm","path":"/tag/docker-swarm/"},{"id":"Labels","title":"Labels","path":"/tag/labels/"},{"id":"Naming Conventions","title":"Naming Conventions","path":"/tag/naming-conventions/"},{"id":"Open Containers Initiative (OCI)","title":"Open Containers Initiative (OCI)","path":"/tag/open-containers-initiative-oci/"}],"description":"How to use Docker Labels with Docker run, Docker compose and Docker Swarm. Also talk about naming conventions and the Open Containers Initiative (OCI) spec.","content":"<h1 id=\"static-docker-labels\"><a href=\"#static-docker-labels\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"true\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Static Docker Labels</h1>\n<p>Docker image names are short and usually not very descriptive. You have the ability to label your Docker images to give them some extra metadata. You can add any information you like, labels are just key value pairs. Here I've added an author label to my <code class=\"language-text\">Dockerfile</code>:</p>\n<div class=\"line-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">FROM</span> microsoft/aspnetcore<span class=\"token punctuation\">:</span>2.0\n<span class=\"token keyword\">LABEL</span> <span class=\"token string\">\"author\"</span>=<span class=\"token string\">\"Muhammad Rehan Saeed\"</span>\n<span class=\"token keyword\">LABEL</span> <span class=\"token string\">\"company\"</span>=<span class=\"token string\">\"Acme Co.\"</span>\n<span class=\"token keyword\">ARG</span> source\n<span class=\"token keyword\">WORKDIR</span> /app\n<span class=\"token keyword\">EXPOSE</span> 80\n<span class=\"token keyword\">COPY</span> $<span class=\"token punctuation\">{</span>source<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span>obj/Docker/publish<span class=\"token punctuation\">}</span> .\n<span class=\"token keyword\">ENTRYPOINT</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"dotnet\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Bridge.Turtle.dll\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Note that prior to Docker <code class=\"language-text\">1.10</code>, it was recommended to combine all labels into a single <code class=\"language-text\">LABEL</code> instruction, to prevent extra layers from being created. This is no longer necessary, but combining labels is still supported.</p>\n<h1 id=\"dynamic-docker-labels\"><a href=\"#dynamic-docker-labels\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"true\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dynamic Docker Labels</h1>\n<p>This is great for static data like the author but not so great for dynamic data like an automated build number or git changeset number that you might want to use. That way you'll know exactly which build built the image and the source code it was built from. This can be valuable information when you're in a pickle with a production issue.</p>\n<p>To add dynamic labels you can pass them from the command line when you run the docker build command like so:</p>\n<div class=\"line-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">docker image build <span class=\"token operator\">--</span>tag foo:1<span class=\"token punctuation\">.</span>0<span class=\"token punctuation\">.</span>0 <span class=\"token operator\">--</span>label <span class=\"token string\">\"build\"</span>=<span class=\"token string\">\"123\"</span> <span class=\"token operator\">--</span>label <span class=\"token string\">\"changeset\"</span>=<span class=\"token string\">\"0d9c7d3b77817caab3977b16d1d76bb3eb024837\"</span> <span class=\"token punctuation\">.</span></code></pre></div>\n<h1 id=\"open-containers-annotations-spec\"><a href=\"#open-containers-annotations-spec\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"true\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Open Containers Annotations Spec</h1>\n<p>The <a href=\"https://www.opencontainers.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Open Containers Initiative (OCI)</a> is a standards body defining open standards for container formats and runtimes. They've already defined a <a href=\"https://github.com/opencontainers/image-spec/blob/master/annotations.md\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">standard set of labels</a> (they call them annotations) for you to use in your Docker images:</p>\n<ul>\n<li><strong>org.opencontainers.image.created</strong> - date and time on which the image was built (string, date-time as defined by <a href=\"https://tools.ietf.org/html/rfc3339#section-5.6\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">RFC 3339</a>).</li>\n<li><strong>org.opencontainers.image.authors</strong> - Contact details of the people or organization responsible for the image (free-form string).</li>\n<li><strong>org.opencontainers.image.url</strong> - URL to find more information on the image (string).</li>\n<li><strong>org.opencontainers.image.documentation</strong> - URL to get documentation on the image (string).</li>\n<li><strong>org.opencontainers.image.source</strong> - URL to get source code for building the image (string).</li>\n<li>\n<p><strong>org.opencontainers.image.version</strong> - Version of the packaged software.</p>\n<ul>\n<li>The version MAY match a label or tag in the source code repository.</li>\n<li>Version MAY be <a href=\"http://semver.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Semantic versioning-compatible</a>.</li>\n</ul>\n</li>\n<li><strong>org.opencontainers.image.revision</strong> - Source control revision identifier for the packaged software.</li>\n<li><strong>org.opencontainers.image.vendor</strong> - Name of the distributing entity, organization or individual.</li>\n<li><strong>org.opencontainers.image.licenses</strong> - License(s) under which contained software is distributed as an SPDX License Expression.</li>\n<li><strong>org.opencontainers.image.ref.name</strong> - Name of the reference for a target (string).</li>\n<li><strong>org.opencontainers.image.title</strong> - Human-readable title of the image (string).</li>\n<li><strong>org.opencontainers.image.description</strong> - Human-readable description of the software packaged in the image (string).</li>\n</ul>\n<h1 id=\"naming-conventions\"><a href=\"#naming-conventions\" aria-hidden=\"true\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"22\" height=\"22\" aria-hidden=\"true\"><path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Naming Conventions</h1>\n<p>The labels in the Open Containers Annotations specification and a few others I've seen use a kind of dot separated namespace. The official Docker documentation suggests that this is only required if your image is a \"third party tool\" which I think means if the image will ever be used as a base for another image:</p>\n<ul>\n<li>Authors of third-party tools should prefix each label key with the reverse DNS notation of a domain they own, such as <code class=\"language-text\">com.example.some-label</code>.</li>\n<li>Do not use a domain in your label key without the domain owner's permission.</li>\n<li>The <code class=\"language-text\">com.docker.*</code>, <code class=\"language-text\">io.docker.*</code>, and <code class=\"language-text\">org.dockerproject.*</code> namespaces are reserved by Docker for internal use.</li>\n<li>Label keys should begin and end with a lower-case letter and should only contain lower-case alphanumeric characters, the period character (<code class=\"language-text\">.</code>), and the hyphen character (<code class=\"language-text\">-</code>). Consecutive periods or hyphens are not allowed.</li>\n<li>The period character (<code class=\"language-text\">.</code>) separates namespace \"fields\". Label keys without namespaces are reserved for CLI use, allowing users of the CLI to interactively label Docker objects using shorter typing-friendly strings.</li>\n</ul>\n<p>For any other images, you can just use simple single word labels or at least, that's what I'm doing.</p>\n","heroImage":"/images/hero/Docker-1366x768.png"}},"context":{}}